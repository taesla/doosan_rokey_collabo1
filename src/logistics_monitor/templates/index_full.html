<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“¦ ë¬¼ë¥˜ ë¡œë´‡ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ (Full)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.0/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* í—¤ë” */
        .header {
            background: rgba(20, 20, 40, 0.95);
            padding: 12px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #00d4ff;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .logo {
            font-size: 1.3em;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-info {
            display: flex;
            gap: 20px;
            align-items: center;
            font-size: 0.85em;
        }

        .header-info span {
            padding: 5px 12px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }

        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9em;
        }

        .status-connected {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            animation: pulse 2s infinite;
        }

        .status-disconnected {
            background: linear-gradient(135deg, #d63031, #b71c1c);
            color: white;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(0, 184, 148, 0.7); }
            50% { box-shadow: 0 0 0 8px rgba(0, 184, 148, 0); }
        }
        
        @keyframes highlight-new {
            0% { background: rgba(0, 212, 255, 0.3); }
            100% { background: transparent; }
        }

        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .tab-nav {
            display: flex;
            background: rgba(20, 20, 40, 0.8);
            padding: 0 20px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
        }

        .tab-btn {
            padding: 12px 25px;
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-btn:hover {
            color: #00d4ff;
        }

        .tab-btn.active {
            color: #00d4ff;
            border-bottom-color: #00d4ff;
        }
        
        /* ë“œë¡­ë‹¤ìš´ íƒ­ ì»¨í…Œì´ë„ˆ */
        .tab-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .tab-dropdown .tab-btn {
            padding-right: 30px;
        }
        
        .tab-dropdown .tab-btn::after {
            content: 'â–¼';
            position: absolute;
            right: 10px;
            font-size: 0.7em;
            transition: transform 0.3s ease;
        }
        
        .tab-dropdown:hover .tab-btn::after,
        .tab-dropdown.open .tab-btn::after {
            transform: rotate(180deg);
        }
        
        .tab-dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: rgba(20, 20, 40, 0.98);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 0 0 8px 8px;
            min-width: 160px;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }
        
        .tab-dropdown:hover .tab-dropdown-menu,
        .tab-dropdown.open .tab-dropdown-menu {
            display: block;
        }
        
        .tab-dropdown-item {
            display: block;
            width: 100%;
            padding: 12px 20px;
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            font-size: 0.9em;
            text-align: left;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        
        .tab-dropdown-item:hover {
            background: rgba(0, 212, 255, 0.1);
            color: #00d4ff;
            border-left-color: #00d4ff;
        }
        
        .tab-dropdown-item.active {
            color: #00d4ff;
            background: rgba(0, 212, 255, 0.15);
            border-left-color: #00d4ff;
        }

        /* íƒ­ ì»¨í…ì¸  */
        .tab-content {
            display: none;
            padding: 20px;
        }

        .tab-content.active {
            display: block;
        }

        /* ë©”ì¸ ê·¸ë¦¬ë“œ */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card {
            background: rgba(30, 30, 50, 0.9);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(0, 212, 255, 0.15);
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: rgba(0, 212, 255, 0.4);
            box-shadow: 0 5px 25px rgba(0, 212, 255, 0.1);
        }

        .card-title {
            font-size: 0.85em;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .card-full {
            grid-column: span 2;
        }

        /* ì¡°ì¸íŠ¸ í…Œì´ë¸” */
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 3px;
            font-size: 0.85em;
        }

        .data-table th {
            padding: 8px 5px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 5px;
            font-size: 0.8em;
            color: #00d4ff;
            font-weight: normal;
        }

        .data-table td {
            padding: 8px 5px;
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .data-table .label {
            color: #888;
            font-weight: bold;
            background: rgba(0, 212, 255, 0.05);
        }

        /* ì˜¨ë„ ìƒ‰ìƒ */
        .temp-normal { color: #00b894; }
        .temp-warn { color: #fdcb6e; }
        .temp-danger { color: #d63031; animation: blink 0.5s infinite; }

        @keyframes blink {
            50% { opacity: 0.5; }
        }

        /* ë¸Œë ˆì´í¬ ìƒíƒœ */
        .brake-on { color: #d63031; }
        .brake-off { color: #00b894; }

        /* TCP ìœ„ì¹˜ í‘œì‹œ */
        .tcp-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
        }

        .tcp-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px 8px;
            border-radius: 8px;
            text-align: center;
        }

        .tcp-label {
            color: #888;
            font-size: 0.75em;
            margin-bottom: 5px;
        }

        .tcp-value {
            font-size: 1.1em;
            font-weight: bold;
            font-family: 'Consolas', monospace;
            color: #00d4ff;
        }

        .tcp-unit {
            font-size: 0.65em;
            color: #666;
        }

        /* í˜ ë°” ê·¸ë˜í”„ */
        .force-container {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            height: 150px;
        }

        .force-bar-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
        }

        .force-bar-bg {
            flex: 1;
            width: 100%;
            max-width: 40px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            overflow: hidden;
        }

        .force-bar {
            width: 100%;
            background: linear-gradient(180deg, #00d4ff, #0066cc);
            border-radius: 5px 5px 0 0;
            transition: height 0.2s ease;
            min-height: 3px;
        }

        .force-label {
            margin-top: 5px;
            font-size: 0.75em;
            color: #888;
        }

        .force-value {
            font-size: 0.8em;
            font-weight: bold;
            font-family: 'Consolas', monospace;
        }

        /* I/O í‘œì‹œ */
        .io-section {
            margin-bottom: 15px;
        }

        .io-section-title {
            font-size: 0.8em;
            color: #888;
            margin-bottom: 8px;
        }

        .io-bits {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .io-bit {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            font-weight: bold;
        }

        .io-off { background: rgba(100, 100, 100, 0.3); color: #555; }
        .io-on { background: linear-gradient(135deg, #00b894, #00d4ff); color: white; }

        .analog-display {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .analog-item {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .analog-label {
            font-size: 0.7em;
            color: #888;
        }

        .analog-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #00d4ff;
            font-family: 'Consolas', monospace;
        }

        /* ì‹œìŠ¤í…œ ìƒíƒœ */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .status-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-label {
            color: #888;
            font-size: 0.85em;
        }

        .status-value {
            font-weight: bold;
            color: #00d4ff;
        }

        .status-value.active { color: #00b894; }
        .status-value.warning { color: #fdcb6e; }
        .status-value.error { color: #d63031; }

        /* TCP ì°¨ì´ ê°•ì¡° */
        .tcp-diff-warn {
            border: 2px solid #fdcb6e !important;
            animation: tcp-diff-pulse 1s infinite;
        }
        
        @keyframes tcp-diff-pulse {
            0%, 100% { background: rgba(253, 203, 110, 0.1); }
            50% { background: rgba(253, 203, 110, 0.2); }
        }

        /* ì°¨íŠ¸ */
        .chart-container {
            position: relative;
            height: 250px;
            width: 100%;
        }

        /* ë¡œê·¸ */
        .log-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .log-item {
            padding: 8px 12px;
            margin: 4px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            border-left: 3px solid;
            font-size: 0.8em;
            display: flex;
            gap: 10px;
        }

        .log-info { border-color: #00b894; }
        .log-warn { border-color: #fdcb6e; }
        .log-error { border-color: #d63031; }

        .log-time {
            color: #666;
            font-family: 'Consolas', monospace;
        }

        /* ì»¨íŠ¸ë¡¤ ë²„íŠ¼ */
        .control-section {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6c5ce7, #a55eea);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #d63031, #b71c1c);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        /* ìŠ¬ë¼ì´ë” */
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .slider-container input[type="range"] {
            flex: 1;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 4px;
            background: rgba(0, 212, 255, 0.3);
        }

        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #00d4ff;
            cursor: pointer;
        }

        .speed-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #00d4ff;
            min-width: 55px;
        }

        /* ì‘ì—… í˜„í™© */
        .task-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .task-stat {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .task-value {
            font-size: 2em;
            font-weight: bold;
        }

        .task-label {
            font-size: 0.8em;
            color: #888;
            margin-top: 5px;
        }

        /* ì œì–´ê¶Œ í‘œì‹œ ë°°ì§€ */
        .badge {
            font-size: 0.65em;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
            vertical-align: middle;
        }
        .badge-topic {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
        }
        .badge-service {
            background: linear-gradient(135deg, #6c5ce7, #a55eea);
            color: white;
        }
        .badge-control {
            background: linear-gradient(135deg, #d63031, #e17055);
            color: white;
        }
        
        /* ë²”ë¡€ */
        .legend-box {
            display: flex;
            gap: 15px;
            padding: 10px 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8em;
            color: #888;
        }
        
        /* 3D ë·°ì–´ */
        .robot-viewer {
            width: 100%;
            height: 300px;
            background: linear-gradient(180deg, #1a1a2e 0%, #0a0a15 100%);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }
        .robot-viewer canvas {
            width: 100% !important;
            height: 100% !important;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 1200px) {
            .grid-4 { grid-template-columns: repeat(2, 1fr); }
            .grid-3 { grid-template-columns: repeat(2, 1fr); }
            .tcp-grid { grid-template-columns: repeat(3, 1fr); }
        }

        @media (max-width: 768px) {
            .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
            .card-full { grid-column: span 1; }
            .tcp-grid { grid-template-columns: repeat(2, 1fr); }
            .task-grid { grid-template-columns: repeat(2, 1fr); }
        }
        
        /* ê²½ê³  íŒì—… ëª¨ë‹¬ */
        .warning-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .warning-modal.show {
            display: flex;
        }
        .warning-content {
            background: linear-gradient(135deg, #2a2a4a 0%, #1a1a2e 100%);
            border: 2px solid #fdcb6e;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 10px 50px rgba(253, 203, 110, 0.3);
            animation: modalSlideIn 0.3s ease;
        }
        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .warning-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }
        .warning-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #fdcb6e;
            margin-bottom: 10px;
        }
        .warning-message {
            color: #ccc;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        .warning-details {
            background: rgba(253, 203, 110, 0.1);
            border: 1px solid rgba(253, 203, 110, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: left;
        }
        .warning-details-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .warning-details-label {
            color: #888;
        }
        .warning-details-value {
            color: #fdcb6e;
            font-weight: bold;
        }
        .warning-details-value.ok {
            color: #00b894;
        }
        .warning-details-value.error {
            color: #d63031;
        }
        .btn-warning-close {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: #1a1a2e;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-warning-close:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(253, 203, 110, 0.4);
        }
        
        /* Tool/TCP ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .tool-info-card {
            background: linear-gradient(135deg, rgba(108, 92, 231, 0.15), rgba(30, 30, 50, 0.9));
            border: 1px solid rgba(108, 92, 231, 0.3);
        }
        .tool-name-display {
            font-size: 1.8em;
            font-weight: bold;
            color: #00d4ff;
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin: 10px 0;
        }
        .tool-name-display.not-set {
            color: #d63031;
            animation: blink 1s infinite;
        }
        .tool-status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .tool-status-ok { background: #00b894; }
        .tool-status-warning { background: #fdcb6e; }
        .tool-status-error { background: #d63031; animation: blink 0.5s infinite; }
        
        /* ë¶„ë¥˜ íƒ­ ìŠ¤íƒ€ì¼ */
        .sort-control-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .sort-control-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .sort-control-buttons .btn {
            flex: 1;
            min-width: 120px;
            padding: 15px 20px;
            font-size: 1.1rem;
            font-weight: 600;
        }
        .sort-status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .sort-status-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        .sort-status-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 5px;
        }
        .sort-status-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
        }
        .sort-stats-card {
            background: linear-gradient(135deg, #232526 0%, #414345 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .sort-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .sort-stat-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        .sort-stat-label {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 5px;
        }
        .sort-stat-value {
            font-size: 1.8rem;
            font-weight: 700;
        }
        .sort-stat-value.completed { color: #00b894; }
        .sort-stat-value.errors { color: #d63031; }
        .sort-stat-value.small { color: #74b9ff; }
        .sort-stat-value.medium { color: #fdcb6e; }
        .sort-stat-value.large { color: #e17055; }
        
        /* ë¶„ë¥˜ ë¡œê·¸ ìŠ¤íƒ€ì¼ */
        .sort-log-card {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 15px;
            padding: 20px;
        }
        .sort-log-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
        }
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .log-entry:last-child {
            border-bottom: none;
        }
        .log-time {
            color: rgba(255, 255, 255, 0.5);
            margin-right: 10px;
        }
        
        /* ë¦¬ì»¤ë²„ë¦¬ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .recovery-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        .recovery-modal.show {
            display: flex;
        }
        .recovery-content {
            background: linear-gradient(135deg, #2a2a4a 0%, #1a1a2e 100%);
            border: 3px solid #e17055;
            border-radius: 20px;
            padding: 40px;
            min-width: 400px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(225, 112, 85, 0.4);
            animation: recoverySlideIn 0.4s ease;
        }
        .recovery-content.completed {
            border-color: #00b894;
            box-shadow: 0 20px 60px rgba(0, 184, 148, 0.4);
        }
        @keyframes recoverySlideIn {
            from { transform: scale(0.8) translateY(-30px); opacity: 0; }
            to { transform: scale(1) translateY(0); opacity: 1; }
        }
        .recovery-icon {
            font-size: 4em;
            margin-bottom: 15px;
            animation: recoveryPulse 1s infinite;
        }
        .recovery-content.completed .recovery-icon {
            animation: none;
        }
        @keyframes recoveryPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .recovery-title {
            font-size: 1.6em;
            font-weight: bold;
            color: #e17055;
            margin-bottom: 10px;
        }
        .recovery-content.completed .recovery-title {
            color: #00b894;
        }
        .recovery-message {
            color: #ccc;
            margin-bottom: 25px;
            font-size: 1.1em;
        }
        .recovery-progress-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .recovery-progress-bar {
            width: 100%;
            height: 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        .recovery-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #e17055, #fdcb6e);
            border-radius: 12px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1a1a2e;
            font-weight: bold;
            font-size: 0.9em;
        }
        .recovery-content.completed .recovery-progress-fill {
            background: linear-gradient(90deg, #00b894, #55efc4);
        }
        .recovery-step {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: #aaa;
            font-size: 1em;
        }
        .recovery-step-icon {
            animation: spin 1s linear infinite;
        }
        .recovery-content.completed .recovery-step-icon {
            animation: none;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .recovery-time {
            margin-top: 15px;
            color: #888;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <!-- ë¦¬ì»¤ë²„ë¦¬ ëª¨ë‹¬ -->
    <div id="recovery-modal" class="recovery-modal">
        <div id="recovery-content" class="recovery-content">
            <div id="recovery-icon" class="recovery-icon">âš ï¸</div>
            <div id="recovery-title" class="recovery-title">ì¶©ëŒ ê°ì§€ - ë³µêµ¬ ëª¨ë“œ</div>
            <div id="recovery-message" class="recovery-message">ìë™ ë³µêµ¬ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤</div>
            <div class="recovery-progress-container">
                <div class="recovery-progress-bar">
                    <div id="recovery-progress-fill" class="recovery-progress-fill" style="width: 0%">0%</div>
                </div>
                <div class="recovery-step">
                    <span id="recovery-step-icon" class="recovery-step-icon">âš™ï¸</span>
                    <span id="recovery-step-text">ì¤€ë¹„ ì¤‘...</span>
                </div>
            </div>
            <div id="recovery-time" class="recovery-time">â±ï¸ ê²½ê³¼ ì‹œê°„: 0ì´ˆ</div>
        </div>
    </div>

    <!-- ê²½ê³  íŒì—… ëª¨ë‹¬ -->
    <div id="warning-modal" class="warning-modal">
        <div class="warning-content">
            <div class="warning-icon">âš ï¸</div>
            <div class="warning-title" id="warning-title">Tool/TCP ì„¤ì • ì£¼ì˜</div>
            <div class="warning-message" id="warning-message">
                Tool ë˜ëŠ” TCPê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
            </div>
            <div class="warning-details" id="warning-details">
                <div class="warning-details-item">
                    <span class="warning-details-label">Current Tool</span>
                    <span class="warning-details-value error" id="warning-tool">ë¯¸ì„¤ì •</span>
                </div>
                <div class="warning-details-item">
                    <span class="warning-details-label">Current TCP</span>
                    <span class="warning-details-value error" id="warning-tcp">ë¯¸ì„¤ì •</span>
                </div>
            </div>
            <button class="btn-warning-close" onclick="closeWarningModal()">í™•ì¸</button>
        </div>
    </div>

    <header class="header">
        <div class="logo">
            <span>ğŸ“¦</span>
            <span>ë¬¼ë¥˜ ë¡œë´‡ ëª¨ë‹ˆí„°ë§</span>
        </div>
        <div class="header-info">
            <span>ğŸ¤– M0609</span>
            <span id="running-time">â±ï¸ 00:00:00</span>
            <span id="program-status">ğŸ“‹ ëŒ€ê¸°</span>
        </div>
        <div id="connection-status" class="status-badge status-disconnected">
            <span>ğŸ”´</span>
            <span>ì—°ê²° ì•ˆë¨</span>
        </div>
    </header>

    <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="tab-nav">
        <button class="tab-btn active" data-tab="overview">ğŸ“Š ê°œìš”</button>
        
        <!-- í™˜ê²½ ì„¤ì • ë“œë¡­ë‹¤ìš´ -->
        <div class="tab-dropdown" id="settings-dropdown">
            <button class="tab-btn" id="settings-tab-btn">âš™ï¸ í™˜ê²½ ì„¤ì •</button>
            <div class="tab-dropdown-menu">
                <button class="tab-dropdown-item" data-tab="robot3d">ğŸ¤– 3D ë·°ì–´</button>
                <button class="tab-dropdown-item" data-tab="toolinfo">ğŸ› ï¸ Tool/TCP</button>
                <button class="tab-dropdown-item" data-tab="joints">ğŸ¦¾ ì¡°ì¸íŠ¸</button>
                <button class="tab-dropdown-item" data-tab="tcp">ğŸ“ TCP/í˜</button>
                <button class="tab-dropdown-item" data-tab="io">ğŸ”Œ I/O</button>
                <button class="tab-dropdown-item" data-tab="system">âš™ï¸ ì‹œìŠ¤í…œ</button>
            </div>
        </div>
        
        <button class="tab-btn" data-tab="control">ğŸ§ª ê¸°ë³¸ ì œì–´</button>
        <button class="tab-btn" data-tab="sorting">ğŸ“¦ ë¶„ë¥˜</button>
        <button class="tab-btn" data-tab="stacking">ğŸ§± ì ì¬</button>
        <button class="tab-btn" data-tab="workspace">ğŸš§ ì‘ì—… ì˜ì—­</button>
        <button class="tab-btn" data-tab="recovery">ğŸ’¾ ë°ì´í„°</button>
    </nav>

    <!-- ë²”ë¡€ -->
    <div style="padding: 15px 20px 0 20px;">
        <div class="legend-box">
            <div class="legend-item"><span class="badge badge-topic">í† í”½</span> ì œì–´ê¶Œ ì—†ì´ ì‹¤ì‹œê°„ ìˆ˜ì‹ </div>
            <div class="legend-item"><span class="badge badge-service">ì„œë¹„ìŠ¤</span> ì œì–´ê¶Œ í•„ìš” (ì½ê¸°)</div>
            <div class="legend-item"><span class="badge badge-control">ì œì–´</span> ì œì–´ê¶Œ í•„ìš” (ì“°ê¸°)</div>
        </div>
    </div>

    <!-- ê°œìš” íƒ­ -->
    <div id="overview" class="tab-content active">
        <div class="grid-4" style="margin-bottom: 15px;">
            <div class="card">
                <div class="card-title">ğŸ¤– ë¡œë´‡ ìƒíƒœ</div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ë¡œë´‡ ë™ì‘ ëª¨ë“œ, ìƒíƒœ, ì†ë„ í˜„í™©</div>
                <div class="status-grid">
                    <div class="status-item">
                        <span class="status-label">ëª¨ë“œ</span>
                        <span class="status-value" id="ov-mode">--</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">ìƒíƒœ</span>
                        <span class="status-value" id="ov-state">--</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">ì†ë„</span>
                        <span class="status-value" id="ov-speed">--%</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">íŠ¹ì´ì </span>
                        <span class="status-value" id="ov-singularity">--</span>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ“ TCP ìœ„ì¹˜ (X/Y/Z)</div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ë¡œë´‡ ëë‹¨(Tool Center Point) ì¢Œí‘œ</div>
                <div style="display: flex; justify-content: space-around; font-size: 1.3em; font-weight: bold;">
                    <div><span style="color: #888; font-size: 0.7em;">X</span> <span id="ov-x" style="color: #ff6384;">0</span></div>
                    <div><span style="color: #888; font-size: 0.7em;">Y</span> <span id="ov-y" style="color: #36a2eb;">0</span></div>
                    <div><span style="color: #888; font-size: 0.7em;">Z</span> <span id="ov-z" style="color: #4bc0c0;">0</span></div>
                </div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ’ª ì™¸ë¶€ í˜ (Fz)</div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">Zì¶• ë°©í–¥ ì™¸ë ¥ (ê·¸ë¦¬í•‘ ê°ì§€)</div>
                <div style="text-align: center;">
                    <div id="ov-fz" style="font-size: 2.5em; font-weight: bold; color: #00d4ff;">0.0</div>
                    <div style="color: #888; font-size: 0.85em;">N (ê·¸ë¦½ ê°ì§€)</div>
                </div>
            </div>
            <div class="card">
                <div class="card-title">ğŸŒ¡ï¸ ìµœê³  ì˜¨ë„</div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ì¡°ì¸íŠ¸ ì¤‘ ê°€ì¥ ë†’ì€ ì˜¨ë„</div>
                <div style="text-align: center;">
                    <div id="ov-max-temp" style="font-size: 2.5em; font-weight: bold;" class="temp-normal">25Â°C</div>
                    <div style="color: #888; font-size: 0.85em;">J<span id="ov-max-temp-joint">1</span></div>
                </div>
            </div>
        </div>
        
        <div class="grid-2">
            <div class="card">
                <div class="card-title">ğŸ“Š ì¡°ì¸íŠ¸ ìœ„ì¹˜ ì°¨íŠ¸</div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">6ê°œ ì¡°ì¸íŠ¸ì˜ ì‹¤ì‹œê°„ ê°ë„ (J1~J6)</div>
                <div class="chart-container">
                    <canvas id="joint-chart"></canvas>
                </div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ“‹ ì‹œìŠ¤í…œ ë¡œê·¸</div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ì´ë²¤íŠ¸ ë° ìƒíƒœ ë³€ê²½ ê¸°ë¡</div>
                <div class="log-list" id="log-list">
                    <div class="log-item log-info">
                        <span class="log-time">--:--:--</span>
                        <span>ì‹œìŠ¤í…œ ì‹œì‘ ëŒ€ê¸°ì¤‘...</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card" style="margin-top: 15px;">
            <div class="card-title">ğŸ“¦ ì‘ì—… í˜„í™©</div>
            <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ì„¸ì…˜ ì™„ë£Œ/ì˜¤ë¥˜/ì†ë„ í†µê³„</div>
            <div class="task-grid">
                <div class="task-stat">
                    <div class="task-value" id="task-completed" style="color: #00b894;">0</div>
                    <div class="task-label">ì™„ë£Œ</div>
                </div>
                <div class="task-stat">
                    <div class="task-value" id="task-errors" style="color: #d63031;">0</div>
                    <div class="task-label">ì˜¤ë¥˜</div>
                </div>
                <div class="task-stat">
                    <div class="task-value" id="task-rate" style="color: #00d4ff;">0</div>
                    <div class="task-label">ê°œ/ì‹œê°„</div>
                </div>
                <div class="task-stat">
                    <div class="task-value" id="task-queue" style="color: #fdcb6e;">0</div>
                    <div class="task-label">ëŒ€ê¸°ì—´</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 3D ë·°ì–´ íƒ­ -->
    <div id="robot3d" class="tab-content">
        <div class="grid-2">
            <!-- RViz ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¼ -->
            <div class="card">
                <div class="card-title">ğŸ–¥ï¸ RViz ì‹¤ì‹œê°„ ë·° <span class="badge badge-topic">ìŠ¤íŠ¸ë¦¼</span></div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ROS RViz ì‹œê°í™” ìŠ¤íŠ¸ë¦¼</div>
                <div style="position: relative; width: 100%; height: 350px; background: #1a1a2e; border-radius: 8px; overflow: hidden;">
                    <img id="rviz-stream" src="/rviz_stream" style="width: 100%; height: 100%; object-fit: contain;" 
                         onerror="this.style.display='none'; document.getElementById('rviz-error').style.display='flex';">
                    <div id="rviz-error" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
                         justify-content: center; align-items: center; color: #888; flex-direction: column;">
                        <span style="font-size: 3em;">ğŸ–¥ï¸</span>
                        <span>RViz ì—°ê²° ëŒ€ê¸°ì¤‘...</span>
                        <button class="btn btn-primary" style="margin-top: 10px;" onclick="reloadRvizStream()">ğŸ”„ ë‹¤ì‹œ ì—°ê²°</button>
                    </div>
                </div>
                <div style="margin-top: 10px; display: flex; justify-content: center; gap: 10px;">
                    <button class="btn btn-primary" onclick="reloadRvizStream()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                    <button class="btn btn-primary" onclick="openRvizFullscreen()">ğŸ”³ ì „ì²´í™”ë©´</button>
                </div>
            </div>
            <!-- 3D ì‹œê°í™” -->
            <div class="card">
                <div class="card-title">ğŸ¤– ë¡œë´‡ 3D ì‹œê°í™” <span class="badge badge-topic">í† í”½</span></div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">Three.js ê¸°ë°˜ ì‹¤ì‹œê°„ ë¡œë´‡ í˜•ìƒ</div>
                <div class="robot-viewer" id="robot-viewer-container" style="height: 350px;">
                    <canvas id="robot-canvas"></canvas>
                </div>
                <div style="margin-top: 10px; display: flex; justify-content: center; gap: 10px;">
                    <button class="btn btn-primary" onclick="resetCameraView()">ğŸ”„ ë·° ë¦¬ì…‹</button>
                    <button class="btn btn-primary" onclick="toggleAutoRotate()">ğŸ” ìë™ íšŒì „</button>
                </div>
            </div>
        </div>
        <div class="grid-3" style="margin-top: 15px;">
            <div class="card">
                <div class="card-title">ğŸ¦¾ ì¡°ì¸íŠ¸ ê°ë„</div>
                <div id="joint-angles-3d" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
                </div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ“ TCP ìœ„ì¹˜</div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ë¡œë´‡ ëë‹¨ ìœ„ì¹˜ ë° ìì„¸</div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
                    <div class="tcp-item"><div class="tcp-label">X</div><div class="tcp-value" id="tcp3d-x">0</div></div>
                    <div class="tcp-item"><div class="tcp-label">Y</div><div class="tcp-value" id="tcp3d-y">0</div></div>
                    <div class="tcp-item"><div class="tcp-label">Z</div><div class="tcp-value" id="tcp3d-z">0</div></div>
                    <div class="tcp-item"><div class="tcp-label">Rx</div><div class="tcp-value" id="tcp3d-rx">0</div></div>
                    <div class="tcp-item"><div class="tcp-label">Ry</div><div class="tcp-value" id="tcp3d-ry">0</div></div>
                    <div class="tcp-item"><div class="tcp-label">Rz</div><div class="tcp-value" id="tcp3d-rz">0</div></div>
                </div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ“Š ìƒíƒœ</div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ë¡œë´‡ ë° ê·¸ë¦¬í¼ ìƒíƒœ</div>
                <div class="status-grid">
                    <div class="status-item">
                        <span class="status-label">ë¡œë´‡ ìƒíƒœ</span>
                        <span class="status-value" id="state3d">STANDBY</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">ê·¸ë¦¬í¼</span>
                        <span class="status-value" id="gripper3d">ì—´ë¦¼</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tool/TCP íƒ­ -->
    <div id="toolinfo" class="tab-content">
        <div class="grid-2">
            <div class="card tool-info-card">
                <div class="card-title">ğŸ”§ Current Tool <span class="badge badge-service">ì„œë¹„ìŠ¤</span></div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">í˜„ì¬ ì„ íƒëœ íˆ´ ì •ë³´</div>
                <div class="tool-name-display" id="tool-name-display">
                    <span class="tool-status-indicator tool-status-ok" id="tool-status-indicator"></span>
                    <span id="current-tool-name">ë¡œë”©ì¤‘...</span>
                </div>
                <div class="status-grid">
                    <div class="status-item">
                        <span class="status-label">Tool Index</span>
                        <span class="status-value" id="tool-info-index">--</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">ìƒíƒœ</span>
                        <span class="status-value" id="tool-info-status">--</span>
                    </div>
                </div>
            </div>
            <div class="card tool-info-card">
                <div class="card-title">ğŸ“ Current TCP <span class="badge badge-service">ì„œë¹„ìŠ¤</span></div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">í˜„ì¬ ì„ íƒëœ TCP ì¢Œí‘œê³„</div>
                <div class="tool-name-display" id="tcp-name-display">
                    <span class="tool-status-indicator tool-status-ok" id="tcp-status-indicator"></span>
                    <span id="current-tcp-name">ë¡œë”©ì¤‘...</span>
                </div>
                <div class="status-grid">
                    <div class="status-item">
                        <span class="status-label">TCP Index</span>
                        <span class="status-value" id="tcp-info-index">--</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">ìƒíƒœ</span>
                        <span class="status-value" id="tcp-info-status">--</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card" style="margin-top: 15px;">
            <div class="card-title">ğŸ“ Tool Flange Position (Base ê¸°ì¤€) <span class="badge badge-service">ì„œë¹„ìŠ¤</span></div>
            <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">íˆ´ í”Œëœì§€ì˜ Base ì¢Œí‘œê³„ ê¸°ì¤€ ìœ„ì¹˜</div>
            <div class="tcp-grid">
                <div class="tcp-item">
                    <div class="tcp-label">X</div>
                    <div class="tcp-value" id="flange-x">0.00</div>
                    <div class="tcp-unit">mm</div>
                </div>
                <div class="tcp-item">
                    <div class="tcp-label">Y</div>
                    <div class="tcp-value" id="flange-y">0.00</div>
                    <div class="tcp-unit">mm</div>
                </div>
                <div class="tcp-item">
                    <div class="tcp-label">Z</div>
                    <div class="tcp-value" id="flange-z">0.00</div>
                    <div class="tcp-unit">mm</div>
                </div>
                <div class="tcp-item">
                    <div class="tcp-label">Rx</div>
                    <div class="tcp-value" id="flange-rx">0.00</div>
                    <div class="tcp-unit">Â°</div>
                </div>
                <div class="tcp-item">
                    <div class="tcp-label">Ry</div>
                    <div class="tcp-value" id="flange-ry">0.00</div>
                    <div class="tcp-unit">Â°</div>
                </div>
                <div class="tcp-item">
                    <div class="tcp-label">Rz</div>
                    <div class="tcp-value" id="flange-rz">0.00</div>
                    <div class="tcp-unit">Â°</div>
                </div>
            </div>
        </div>
        
        <div class="grid-2" style="margin-top: 15px;">
            <div class="card">
                <div class="card-title">â„¹ï¸ Tool/TCP ì •ë³´ ì•ˆë‚´</div>
                <div style="padding: 15px; color: #888; line-height: 1.8;">
                    <p><strong style="color: #00d4ff;">Tool</strong>: ë¡œë´‡ ëë‹¨ì— ì¥ì°©ëœ ë„êµ¬ì˜ ë¬´ê²Œ, ë¬´ê²Œì¤‘ì‹¬ ë“±ì˜ ì •ë³´</p>
                    <p><strong style="color: #00d4ff;">TCP (Tool Center Point)</strong>: ë„êµ¬ì˜ ì‘ì—… ê¸°ì¤€ì  ì¢Œí‘œ ì˜¤í”„ì…‹</p>
                    <p style="margin-top: 10px; padding: 10px; background: rgba(253, 203, 110, 0.1); border-radius: 8px; border-left: 3px solid #fdcb6e;">
                        âš ï¸ Tool ë˜ëŠ” TCPê°€ ì„¤ì •ë˜ì§€ ì•Šìœ¼ë©´ ì •í™•í•œ ì‘ì—… ìˆ˜í–‰ì´ ì–´ë µìŠµë‹ˆë‹¤.
                    </p>
                </div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ”„ Tool/TCP ìƒíƒœ ì²´í¬</div>
                <div style="padding: 15px;">
                    <div class="status-grid">
                        <div class="status-item">
                            <span class="status-label">Tool ì„¤ì •</span>
                            <span class="status-value" id="tool-check-status">--</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">TCP ì„¤ì •</span>
                            <span class="status-value" id="tcp-check-status">--</span>
                        </div>
                        <div class="status-item" style="grid-column: span 2;">
                            <span class="status-label">ë§ˆì§€ë§‰ í™•ì¸</span>
                            <span class="status-value" id="tool-check-time">--</span>
                        </div>
                    </div>
                    <button class="btn btn-primary" style="width: 100%; margin-top: 15px;" onclick="checkToolTcpStatus()">
                        ğŸ” Tool/TCP ìƒíƒœ í™•ì¸
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì¡°ì¸íŠ¸ íƒ­ -->
    <div id="joints" class="tab-content">
        <div class="grid-2">
            <div class="card">
                <div class="card-title">ğŸ¯ ì‹¤ì œ ì¡°ì¸íŠ¸ ë°ì´í„° (Actual) <span class="badge badge-topic">í† í”½</span></div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ê° ì¡°ì¸íŠ¸ì˜ ì‹¤ì œ ì¸¡ì •ê°’ (ìœ„ì¹˜/ì†ë„/í† í¬)</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>ìœ„ì¹˜ (Â°)</th>
                            <th>ì†ë„ (Â°/s)</th>
                            <th>í† í¬ (Nm) <span class="badge badge-service" style="font-size:0.7em">ì„œë¹„ìŠ¤</span></th>
                            <th>ëª¨í„°í† í¬</th>
                            <th>ê°€ì†ë„</th>
                        </tr>
                    </thead>
                    <tbody id="actual-joint-table"></tbody>
                </table>
            </div>
            <div class="card">
                <div class="card-title">ğŸ¯ ëª©í‘œ ì¡°ì¸íŠ¸ ë°ì´í„° (Target) <span class="badge badge-service">ì„œë¹„ìŠ¤</span></div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ê° ì¡°ì¸íŠ¸ì˜ ëª©í‘œê°’ ë° í¸ì°¨</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>ìœ„ì¹˜ (Â°)</th>
                            <th>ì†ë„ (Â°/s)</th>
                            <th>í¸ì°¨ (Â°)</th>
                        </tr>
                    </thead>
                    <tbody id="target-joint-table"></tbody>
                </table>
            </div>
            <div class="card">
                <div class="card-title">ğŸŒ¡ï¸ ì¡°ì¸íŠ¸ ì˜¨ë„</div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ê° ì¡°ì¸íŠ¸ ëª¨í„° ì˜¨ë„ (Â°C)</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>J1</th>
                            <th>J2</th>
                            <th>J3</th>
                            <th>J4</th>
                            <th>J5</th>
                            <th>J6</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id="temp-row"></tr>
                    </tbody>
                </table>
            </div>
            <div class="card">
                <div class="card-title">ğŸ”’ ë¸Œë ˆì´í¬ ìƒíƒœ / ì ˆëŒ€ìœ„ì¹˜</div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ë¸Œë ˆì´í¬ ìƒíƒœ ë° ì ˆëŒ€ ìœ„ì¹˜ ì˜¤ë¥˜</div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>J1</th>
                            <th>J2</th>
                            <th>J3</th>
                            <th>J4</th>
                            <th>J5</th>
                            <th>J6</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id="brake-row">
                            <td class="label">ë¸Œë ˆì´í¬</td>
                        </tr>
                        <tr id="abs-pos-row">
                            <td class="label">ì ˆëŒ€ìœ„ì¹˜</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- TCP/í˜ íƒ­ -->
    <div id="tcp" class="tab-content">
        <!-- í˜„ì¬ vs ëª©í‘œ ë¹„êµ í…Œì´ë¸” -->
        <div class="card" style="margin-bottom: 15px;">
            <div class="card-title">ğŸ“Š í˜„ì¬(Actual) vs ëª©í‘œ(Desired) TCP ìœ„ì¹˜ ë¹„êµ <span class="badge badge-service">ì„œë¹„ìŠ¤</span></div>
            <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ì‹¤ì œ ì¸¡ì •ê°’ê³¼ ëª©í‘œê°’ ë¹„êµ (í¸ì°¨ í™•ì¸)</div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ì¶•</th>
                        <th>í˜„ì¬ (Actual)</th>
                        <th>ëª©í‘œ (Desired)</th>
                        <th>ì°¨ì´ (Î”)</th>
                        <th>ë‹¨ìœ„</th>
                    </tr>
                </thead>
                <tbody id="tcp-compare-table">
                    <tr><td>X</td><td>--</td><td>--</td><td>--</td><td>mm</td></tr>
                    <tr><td>Y</td><td>--</td><td>--</td><td>--</td><td>mm</td></tr>
                    <tr><td>Z</td><td>--</td><td>--</td><td>--</td><td>mm</td></tr>
                    <tr><td>A</td><td>--</td><td>--</td><td>--</td><td>Â°</td></tr>
                    <tr><td>B</td><td>--</td><td>--</td><td>--</td><td>Â°</td></tr>
                    <tr><td>C</td><td>--</td><td>--</td><td>--</td><td>Â°</td></tr>
                </tbody>
            </table>
            <div style="margin-top: 10px; padding: 10px; background: rgba(0, 212, 255, 0.1); border-radius: 8px; font-size: 0.85em; color: #888;">
                ğŸ’¡ <strong>ì°¸ê³ :</strong> ROS2ì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°›ì€ ë°ì´í„°ì…ë‹ˆë‹¤. ë¡œë´‡ ì´ë™ ì¤‘ì—ëŠ” Actual â†’ Desiredë¡œ ìˆ˜ë ´í•©ë‹ˆë‹¤.
            </div>
        </div>
    
        <div class="grid-2">
            <div class="card">
                <div class="card-title">ğŸ“ ì‹¤ì œ TCP ìœ„ì¹˜ (Actual) <span class="badge badge-service">ì„œë¹„ìŠ¤</span></div>
                <div class="tcp-grid" id="actual-tcp"></div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ¯ ëª©í‘œ TCP ìœ„ì¹˜ (Desired) <span class="badge badge-service">ì„œë¹„ìŠ¤</span></div>
                <div class="tcp-grid" id="target-tcp"></div>
            </div>
            <div class="card">
                <div class="card-title">ğŸš€ TCP ì†ë„ (Actual) <span class="badge badge-service">ì„œë¹„ìŠ¤</span></div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ì‹¤ì œ ì¸¡ì •ëœ TCP ì†ë„</div>
                <div class="tcp-grid" id="actual-tcp-vel"></div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ¯ TCP ì†ë„ (Desired) <span class="badge badge-service">ì„œë¹„ìŠ¤</span></div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ëª©í‘œ TCP ì†ë„</div>
                <div class="tcp-grid" id="target-tcp-vel"></div>
            </div>
        </div>
        
        <div class="grid-3" style="margin-top: 15px;">
            <div class="card">
                <div class="card-title">ğŸ’ª ì™¸ë¶€ TCP í˜/í† í¬ <span class="badge badge-service">ì„œë¹„ìŠ¤</span></div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">TCPì— ì‘ìš©í•˜ëŠ” ì™¸ë¶€ í˜</div>
                <div class="force-container" id="external-force"></div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ”§ ì‹¤ì œ íˆ´ í˜/í† í¬ <span class="badge badge-service">ì„œë¹„ìŠ¤</span></div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">íˆ´ì— ì‘ìš©í•˜ëŠ” ì‹¤ì œ í˜</div>
                <div class="force-container" id="actual-tool-force"></div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ¯ ëª©í‘œ í˜/í† í¬ <span class="badge badge-service">ì„œë¹„ìŠ¤</span></div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ì œì–´ ëª©í‘œ í˜/í† í¬</div>
                <div class="force-container" id="target-force"></div>
            </div>
        </div>
    </div>

    <!-- I/O íƒ­ -->
    <div id="io" class="tab-content">
        <div class="grid-2">
            <div class="card">
                <div class="card-title">ğŸ“¥ Controller Digital Input (16ch) <span class="badge badge-service">ì„œë¹„ìŠ¤</span></div>
                <div style="color: #888; font-size: 0.8em; margin-bottom: 10px;">ë¡œë´‡ ì œì–´ê¸°ë¡œ ë“¤ì–´ì˜¤ëŠ” ë””ì§€í„¸ ì‹ í˜¸ (ì„¼ì„œ, ìŠ¤ìœ„ì¹˜ ë“±)</div>
                <div class="io-bits" id="ctrl-din"></div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ“¤ Controller Digital Output (16ch) <span class="badge badge-service">ì„œë¹„ìŠ¤</span></div>
                <div style="color: #888; font-size: 0.8em; margin-bottom: 10px;">ë¡œë´‡ ì œì–´ê¸°ì—ì„œ ë‚˜ê°€ëŠ” ë””ì§€í„¸ ì‹ í˜¸ (ê·¸ë¦¬í¼: DO1/DO2)</div>
                <div class="io-bits" id="ctrl-dout"></div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ“Š Controller Analog I/O</div>
                <div style="color: #888; font-size: 0.8em; margin-bottom: 10px;">ì œì–´ê¸°ì˜ ì•„ë‚ ë¡œê·¸ ì…ì¶œë ¥ (ì „ì•• 0~10V)</div>
                <div class="analog-display">
                    <div class="analog-item">
                        <div class="analog-label">AIN 0</div>
                        <div class="analog-value" id="ctrl-ain0">0.00 V</div>
                    </div>
                    <div class="analog-item">
                        <div class="analog-label">AIN 1</div>
                        <div class="analog-value" id="ctrl-ain1">0.00 V</div>
                    </div>
                    <div class="analog-item">
                        <div class="analog-label">AOUT 0</div>
                        <div class="analog-value" id="ctrl-aout0">0.00 V</div>
                    </div>
                    <div class="analog-item">
                        <div class="analog-label">AOUT 1</div>
                        <div class="analog-value" id="ctrl-aout1">0.00 V</div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ”Œ Flange I/O</div>
                <div style="color: #888; font-size: 0.8em; margin-bottom: 10px;">ë¡œë´‡ ëë‹¨(í”Œëœì§€)ì˜ I/O - ê·¸ë¦¬í¼/íˆ´ ì—°ê²°</div>
                <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                    <div>
                        <span style="color: #888; font-size: 0.85em;">Digital IN:</span>
                        <span id="flange-din" style="font-size: 1.2em; font-weight: bold; color: #00d4ff; margin-left: 10px;">0</span>
                    </div>
                    <div>
                        <span style="color: #888; font-size: 0.85em;">Digital OUT:</span>
                        <span id="flange-dout" style="font-size: 1.2em; font-weight: bold; color: #00b894; margin-left: 10px;">0</span>
                    </div>
                </div>
                <div class="analog-display">
                    <div class="analog-item">
                        <div class="analog-label">Flange AIN 0</div>
                        <div class="analog-value" id="flange-ain0">0.00 V</div>
                    </div>
                    <div class="analog-item">
                        <div class="analog-label">Flange AIN 1</div>
                        <div class="analog-value" id="flange-ain1">0.00 V</div>
                    </div>
                    <div class="analog-item">
                        <div class="analog-label">Flange AIN 2</div>
                        <div class="analog-value" id="flange-ain2">0.00 V</div>
                    </div>
                    <div class="analog-item">
                        <div class="analog-label">Flange AIN 3</div>
                        <div class="analog-value" id="flange-ain3">0.00 V</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì‹œìŠ¤í…œ íƒ­ -->
    <div id="system" class="tab-content">
        <div class="grid-3">
            <div class="card">
                <div class="card-title">ğŸ¤– ë¡œë´‡ ìƒíƒœ</div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ìƒì„¸ ë¡œë´‡ ìƒíƒœ ì •ë³´</div>
                <div class="status-grid">
                    <div class="status-item">
                        <span class="status-label">ë¡œë´‡ ëª¨ë“œ</span>
                        <span class="status-value" id="sys-mode">--</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">ë¡œë´‡ ìƒíƒœ</span>
                        <span class="status-value" id="sys-state">--</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">ì‘ì—… ì†ë„</span>
                        <span class="status-value" id="sys-speed">--%</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">íŠ¹ì´ì  ì§€ìˆ˜</span>
                        <span class="status-value" id="sys-singularity">--</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">ì†”ë£¨ì…˜ ê³µê°„</span>
                        <span class="status-value" id="sys-solution">--</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">ì ‘ê·¼ ì œì–´</span>
                        <span class="status-value" id="sys-access">--</span>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ“‹ í”„ë¡œê·¸ë¨ ìƒíƒœ</div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">í”„ë¡œê·¸ë¨ ì‹¤í–‰ ë° ê°€ë™ ì‹œê°„</div>
                <div class="status-grid">
                    <div class="status-item">
                        <span class="status-label">í”„ë¡œê·¸ë¨ ì‹¤í–‰</span>
                        <span class="status-value" id="sys-program">--</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">ê°€ë™ ì‹œê°„</span>
                        <span class="status-value" id="sys-runtime">--</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">ì•ˆì „ì •ì§€ ë¦¬ì…‹</span>
                        <span class="status-value" id="sys-safestop">--</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">íƒ€ì„ìŠ¤íƒ¬í”„</span>
                        <span class="status-value" id="sys-timestamp">--</span>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ”§ íˆ´/ì¢Œí‘œê³„</div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">í˜„ì¬ íˆ´ ë° TCP ì¢Œí‘œê³„ ì„¤ì •</div>
                <div class="status-grid">
                    <div class="status-item">
                        <span class="status-label">íˆ´ ì¸ë±ìŠ¤</span>
                        <span class="status-value" id="sys-tool">--</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">TCP ì¸ë±ìŠ¤</span>
                        <span class="status-value" id="sys-tcp">--</span>
                    </div>
                    <div class="status-item" style="grid-column: span 2;">
                        <span class="status-label">ì¤‘ë ¥ ë°©í–¥</span>
                        <span class="status-value" id="sys-gravity">--</span>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-title">âš ï¸ ì—ëŸ¬ ì •ë³´</div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ë¡œë´‡ ì—ëŸ¬ ì½”ë“œ ë° ë©”ì‹œì§€</div>
                <div class="status-grid">
                    <div class="status-item">
                        <span class="status-label">ì—ëŸ¬ ë ˆë²¨</span>
                        <span class="status-value" id="sys-error-level">0</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">ì—ëŸ¬ ì½”ë“œ</span>
                        <span class="status-value" id="sys-error-code">0</span>
                    </div>
                    <div class="status-item" style="grid-column: span 2;">
                        <span class="status-label">ë©”ì‹œì§€</span>
                        <span class="status-value" id="sys-error-msg" style="font-size: 0.8em;">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì œì–´ íƒ­ -->
    <div id="control" class="tab-content">
        <div style="padding: 0 0 15px 0;">
            <div class="legend-box" style="background: rgba(214, 48, 49, 0.1); border: 1px solid rgba(214, 48, 49, 0.3);">
                <div class="legend-item" style="color: #d63031;">âš ï¸ ì´ íƒ­ì˜ ê¸°ëŠ¥ì€ <span class="badge badge-control">ì œì–´ê¶Œ</span>ì´ í•„ìš”í•©ë‹ˆë‹¤. ì œì–´ê¶Œì´ ì—†ìœ¼ë©´ ëª…ë ¹ì´ ë¬´ì‹œë©ë‹ˆë‹¤.</div>
            </div>
        </div>
        <div class="grid-2">
            <div class="card">
                <div class="card-title">ğŸšï¸ ì†ë„ ì œì–´ <span class="badge badge-control">ì œì–´</span></div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ë¡œë´‡ ì‘ì—… ì†ë„ ìŠ¬ë¼ì´ë” (1~100%)</div>
                <div style="padding: 20px;">
                    <div id="moving-status-local" style="padding: 10px; margin-bottom: 15px; border-radius: 8px; text-align: center; font-weight: bold; display: none; background: rgba(255, 193, 7, 0.2); color: #ffc107;">
                        ğŸŸ¡ ë¡œë´‡ ë™ì‘ ì¤‘... (ì†ë„ ë³€ê²½ì€ ë‹¤ìŒ ë™ì‘ë¶€í„° ì ìš©)
                    </div>
                    <div style="color: #888; margin-bottom: 15px;">ì‘ì—… ì†ë„ ì¡°ì ˆ</div>
                    <div class="slider-container">
                        <span style="color: #888;">0%</span>
                        <input type="range" id="speed-slider" min="1" max="100" value="100">
                        <span style="color: #888;">100%</span>
                        <span class="speed-value"><span id="speed-display">100</span>%</span>
                        <button id="btn-speed-reset" style="margin-left: 10px; padding: 5px 12px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">ğŸ”„ 100%</button>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-title">ğŸ”’ ê·¸ë¦¬í¼ ìƒíƒœ</div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ì§„ê³µ ê·¸ë¦¬í¼ ì—´ë¦¼/ë‹«í˜ ìƒíƒœ</div>
                <div style="padding: 20px; text-align: center;">
                    <div id="gripper-status-display" style="font-size: 3em; margin-bottom: 10px;">ğŸ”’</div>
                    <div id="gripper-status-text" style="font-size: 1.2em; color: #00d4ff; font-weight: bold;">í™•ì¸ ì¤‘...</div>
                    <div style="margin-top: 10px; color: #888; font-size: 0.85em;">
                        DO1: <span id="gripper-do1-status">--</span> | 
                        DO2: <span id="gripper-do2-status">--</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card" style="margin-top: 15px;">
            <div class="card-title">ğŸ® ë¡œë´‡ ì œì–´ <span class="badge badge-control">ì œì–´</span></div>
            <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ê·¸ë¦¬í¼/í™ˆ ì´ë™/ë¹„ìƒì •ì§€ ë²„íŠ¼</div>
            <div class="control-section" style="padding: 20px; display: flex; gap: 15px; flex-wrap: wrap;">
                <button class="btn btn-success" id="btn-gripper-open" style="flex: 1; min-width: 120px;">ğŸ”“ ê·¸ë¦¬í¼ ì—´ê¸°</button>
                <button class="btn btn-primary" id="btn-gripper-close" style="flex: 1; min-width: 120px;">ğŸ”’ ê·¸ë¦¬í¼ ë‹«ê¸°</button>
                <button class="btn btn-warning" id="btn-move-user-home" style="flex: 1; min-width: 120px;">ğŸ  ì‚¬ìš©ì í™ˆ</button>
                <button class="btn btn-secondary" id="btn-move-mech-home" style="flex: 1; min-width: 120px;">ğŸ  ê¸°ê³„ì  í™ˆ</button>
                <button class="btn btn-danger" id="btn-estop" style="flex: 1; min-width: 120px;">ğŸ›‘ ë¹„ìƒì •ì§€</button>
                <button class="btn" id="btn-resume" style="flex: 1; min-width: 120px; background: #27ae60;" disabled>â–¶ï¸ ì¬ê°œ</button>
            </div>
        </div>
        
        <div class="card" style="margin-top: 15px;">
            <div class="card-title">ğŸ”„ ì§„ììš´ë™ í…ŒìŠ¤íŠ¸ <span class="badge badge-control">ì œì–´</span></div>
            <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ì¡°ì¸íŠ¸ ì§„ë™ í…ŒìŠ¤íŠ¸ (ë™ì‘ í™•ì¸ìš©)</div>
            <div class="control-section" style="padding: 20px;">
                <p style="color: #888; font-size: 0.9em; margin-bottom: 15px;">
                    ğŸ§ª í˜„ì¬ ìœ„ì¹˜ì—ì„œ ì„ íƒí•œ ì¡°ì¸íŠ¸ë¥¼ ì¢Œìš°ë¡œ í”ë“¤ì–´ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤. ì‘ì—… ì†ë„ì— ì˜í–¥ì„ ë°›ìŠµë‹ˆë‹¤.
                </p>
                <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 15px;">
                    <label style="color: #888; min-width: 80px;">ì¡°ì¸íŠ¸:</label>
                    <select id="pendulum-joint" style="padding: 8px 12px; border-radius: 8px; background: #2a2a2a; color: #fff; border: 1px solid #444;">
                        <option value="0">J1 (ë² ì´ìŠ¤ íšŒì „)</option>
                        <option value="1">J2 (ìˆ„ë”)</option>
                        <option value="2">J3 (ì—˜ë³´)</option>
                        <option value="3">J4 (ì†ëª©1)</option>
                        <option value="4" selected>J5 (ì†ëª©2)</option>
                        <option value="5">J6 (ì†ëª©3)</option>
                    </select>
                </div>
                <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 15px;">
                    <label style="color: #888; min-width: 80px;">ì§„í­ (Â°):</label>
                    <input type="number" id="pendulum-amplitude" value="15" min="5" max="45" step="5" 
                        style="padding: 8px 12px; border-radius: 8px; background: #2a2a2a; color: #fff; border: 1px solid #444; width: 100px;">
                    <span style="color: #666; font-size: 0.85em;">Â±5Â° ~ Â±45Â°</span>
                </div>
                <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 15px;">
                    <label style="color: #888; min-width: 80px;">ì†ë„ (Â°/s):</label>
                    <input type="number" id="pendulum-velocity" value="30" min="5" max="100" step="5" 
                        style="padding: 8px 12px; border-radius: 8px; background: #2a2a2a; color: #fff; border: 1px solid #444; width: 100px;">
                    <span style="color: #666; font-size: 0.85em;">5 ~ 100 Â°/s</span>
                </div>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="btn btn-success" id="btn-pendulum-start" style="flex: 1; min-width: 120px;">â–¶ï¸ ì§„ììš´ë™ ì‹œì‘</button>
                    <button class="btn btn-danger" id="btn-pendulum-stop" style="flex: 1; min-width: 120px;" disabled>â¹ï¸ ì§„ììš´ë™ ì •ì§€</button>
                </div>
                <div id="pendulum-status" style="margin-top: 15px; padding: 10px; border-radius: 8px; background: #2a2a2a; text-align: center; color: #888;">
                    â¸ï¸ ì§„ììš´ë™ í…ŒìŠ¤íŠ¸ ë¹„í™œì„±í™”
                </div>
            </div>
        </div>
        
        <div class="card" style="margin-top: 15px;">
            <div class="card-title">ğŸ“‹ ì œì–´ ë¡œê·¸</div>
            <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ì œì–´ ëª…ë ¹ ì‹¤í–‰ ê¸°ë¡</div>
            <div class="log-list" id="control-log-list" style="max-height: 200px;">
            </div>
        </div>
    </div>

    <!-- ë¶„ë¥˜ íƒ­ -->
    <div id="sorting" class="tab-content">
        <!-- ğŸ“Š ë¶„ë¥˜ ì‘ì—… ìš”ì•½ í…Œì´ë¸” -->
        <div class="card">
            <div class="card-title">ğŸ“Š ë¶„ë¥˜ ì‘ì—… ìš”ì•½</div>
            <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ì‹¤ì‹œê°„ ë¶„ë¥˜ ìƒíƒœ ë° ì¹´ìš´íŠ¸</div>
            <div style="padding: 15px;">
                <table style="width: 100%; border-collapse: collapse; background: rgba(0,0,0,0.3); border-radius: 8px; overflow: hidden;">
                    <thead>
                        <tr style="background: rgba(0,184,148,0.15);">
                            <th style="padding: 12px; text-align: center; color: #00b894; font-size: 0.85em; border-bottom: 1px solid rgba(255,255,255,0.1);">ìƒíƒœ</th>
                            <th style="padding: 12px; text-align: center; color: #00b894; font-size: 0.85em; border-bottom: 1px solid rgba(255,255,255,0.1);">í˜„ì¬ ì‹œí€€ìŠ¤</th>
                            <th style="padding: 12px; text-align: center; color: #00b894; font-size: 0.85em; border-bottom: 1px solid rgba(255,255,255,0.1);">ì»¨ë² ì´ì–´</th>
                            <th style="padding: 12px; text-align: center; color: #2ecc71; font-size: 0.85em; border-bottom: 1px solid rgba(255,255,255,0.1);">S</th>
                            <th style="padding: 12px; text-align: center; color: #f1c40f; font-size: 0.85em; border-bottom: 1px solid rgba(255,255,255,0.1);">M</th>
                            <th style="padding: 12px; text-align: center; color: #e74c3c; font-size: 0.85em; border-bottom: 1px solid rgba(255,255,255,0.1);">L</th>
                            <th style="padding: 12px; text-align: center; color: #00b894; font-size: 0.85em; border-bottom: 1px solid rgba(255,255,255,0.1);">ë§ˆì§€ë§‰</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 12px; text-align: center;">
                                <span id="sort-status-icon" style="font-size: 1.5em;">â¸ï¸</span>
                                <div id="sort-status-text" style="font-size: 0.8em; color: #00d4ff; margin-top: 3px;">ëŒ€ê¸° ì¤‘</div>
                            </td>
                            <td style="padding: 12px; text-align: center;">
                                <span id="sort-phase" style="font-weight: bold; color: #3498db; font-size: 1.1em;">--</span>
                            </td>
                            <td style="padding: 12px; text-align: center;">
                                <span id="conveyor-status-icon" style="font-size: 1.2em;">âš«</span>
                                <span id="conveyor-status-text" style="color: #888; font-size: 0.85em; margin-left: 5px;">ì—°ê²° ì•ˆë¨</span>
                            </td>
                            <td style="padding: 12px; text-align: center;">
                                <span id="sort-small-count" style="font-weight: bold; color: #2ecc71; font-size: 1.3em;">0</span>
                            </td>
                            <td style="padding: 12px; text-align: center;">
                                <span id="sort-medium-count" style="font-weight: bold; color: #f1c40f; font-size: 1.3em;">0</span>
                            </td>
                            <td style="padding: 12px; text-align: center;">
                                <span id="sort-long-count" style="font-weight: bold; color: #e74c3c; font-size: 1.3em;">0</span>
                            </td>
                            <td style="padding: 12px; text-align: center;">
                                <span id="sort-last-width" style="font-weight: bold; color: #fdcb6e; font-size: 1.1em;">--</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ì œì–´ + ì´ë²¤íŠ¸ ë¡œê·¸ -->
        <div style="display: grid; grid-template-columns: 1fr 1.5fr; gap: 15px; margin-top: 15px;">
            <!-- ë¶„ë¥˜ ì œì–´ -->
            <div class="card">
                <div class="card-title">ğŸ® ë¶„ë¥˜ ì‘ì—… ì œì–´</div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ë¶„ë¥˜ ì‹œì‘/ì •ì§€/ì›í…Œì´í¬ ë²„íŠ¼</div>
                <div style="padding: 15px;">
                    <!-- ë©”ì¸ ì œì–´ ë²„íŠ¼ -->
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <button class="btn btn-success" id="btn-sort-start" style="padding: 15px; font-size: 1.1em; font-weight: bold;">
                            â–¶ï¸ ë¶„ë¥˜ ì‹œì‘
                        </button>
                        <button class="btn btn-secondary" id="btn-sort-home" style="padding: 15px; font-size: 1.1em; font-weight: bold;">
                            ğŸ  í™ˆìœ¼ë¡œ ì´ë™
                        </button>
                        <button class="btn" id="btn-one-take" style="padding: 15px; font-size: 1.1em; font-weight: bold; background: linear-gradient(135deg, #9c27b0, #7b1fa2); grid-column: span 2;">
                            ğŸ¬ ì›í…Œì´í¬ ì‹œë‚˜ë¦¬ì˜¤
                        </button>
                    </div>
                    
                    <!-- ì»¨ë² ì´ì–´ ì œì–´ -->
                    <div style="margin-top: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <button class="btn btn-primary" id="btn-conveyor-mode" style="padding: 12px; font-size: 0.95em;">
                            ğŸ”„ ìë™ ëª¨ë“œ
                        </button>
                        <button class="btn btn-secondary" id="btn-conveyor-resume" style="padding: 12px; font-size: 0.95em;">
                            â–¶ï¸ ì»¨ë² ì´ì–´ ì¬ì‹œì‘
                        </button>
                    </div>
                    
                    <!-- ìƒíƒœ ë©”ì‹œì§€ -->
                    <div id="sort-message" style="margin-top: 12px; padding: 12px; border-radius: 8px; background: rgba(0,0,0,0.3); text-align: center; color: #888; font-size: 0.9em;">
                        ë¶„ë¥˜ ì‘ì—…ì„ ì‹œì‘í•˜ë ¤ë©´ "ë¶„ë¥˜ ì‹œì‘" ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”
                    </div>
                    
                    <!-- DSR ì—°ê²° ìƒíƒœ -->
                    <div id="sort-dsr-status" style="margin-top: 8px; text-align: center; color: #888; font-size: 0.8em;">DSR ë¡œë´‡: í™•ì¸ ì¤‘...</div>
                </div>
            </div>
            
            <!-- ğŸ“‹ ë¶„ë¥˜ ì´ë²¤íŠ¸ ë¡œê·¸ (ìµœëŒ€ 10ê°œ) -->
            <div class="card">
                <div class="card-title">ğŸ“‹ ë¶„ë¥˜ ì´ë²¤íŠ¸ <span style="color: #888; font-size: 0.8em; font-weight: normal;">(ìµœëŒ€ 10ê°œ)</span></div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ë¶„ë¥˜ ì‘ì—… ì´ë²¤íŠ¸ ê¸°ë¡</div>
                <div style="padding: 15px;">
                    <table style="width: 100%; border-collapse: collapse; background: rgba(0,0,0,0.3); border-radius: 8px; overflow: hidden;">
                        <thead>
                            <tr style="background: rgba(52,152,219,0.15);">
                                <th style="padding: 10px 12px; text-align: left; color: #3498db; font-size: 0.8em; width: 90px;">ì‹œê°„</th>
                                <th style="padding: 10px 12px; text-align: center; color: #3498db; font-size: 0.8em; width: 80px;">ì´ë²¤íŠ¸</th>
                                <th style="padding: 10px 12px; text-align: left; color: #3498db; font-size: 0.8em;">ìƒì„¸ ë‚´ìš©</th>
                            </tr>
                        </thead>
                        <tbody id="sort-event-tbody">
                            <tr class="event-row" style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                                <td style="padding: 10px 12px; color: #888; font-family: monospace; font-size: 0.85em;">--:--:--</td>
                                <td style="padding: 10px 12px; text-align: center;"><span style="padding: 3px 8px; border-radius: 4px; background: rgba(136,136,136,0.2); color: #888; font-size: 0.8em;">ëŒ€ê¸°</span></td>
                                <td style="padding: 10px 12px; color: #888; font-size: 0.9em;">ë¶„ë¥˜ ì‹œìŠ¤í…œ ëŒ€ê¸°ì¤‘...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- ì»¨ë² ì´ì–´ ìƒíƒœ + ë¶„ë¥˜ ìœ„ì¹˜ -->
        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 15px; margin-top: 15px;">
            <!-- ì»¨ë² ì´ì–´ ìƒì„¸ -->
            <div class="card">
                <div class="card-title">ğŸ”— ì»¨ë² ì´ì–´ ìƒì„¸</div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ë¬¼ì²´ ê°ì§€ ë° ìë™ ëª¨ë“œ ìƒíƒœ</div>
                <div style="padding: 15px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div style="text-align: center; padding: 12px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                            <div id="conveyor-detect-icon" style="font-size: 1.5em; margin-bottom: 5px;">ğŸ“¦</div>
                            <div style="color: #888; font-size: 0.8em;">ë¬¼ì²´ ê°ì§€</div>
                            <div id="conveyor-detect-text" style="color: #888; font-size: 0.85em;">ê°ì§€ ì•ˆë¨</div>
                        </div>
                        <div style="text-align: center; padding: 12px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                            <div style="font-size: 1.5em; margin-bottom: 5px;">ğŸ¤–</div>
                            <div style="color: #888; font-size: 0.8em;">ìë™ ëª¨ë“œ</div>
                            <div id="conveyor-auto-text" style="color: #888; font-size: 0.85em;">ë¹„í™œì„±</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ë¶„ë¥˜ ìœ„ì¹˜ ì •ë³´ -->
            <div class="card">
                <div class="card-title">ğŸ“ ë¶„ë¥˜ ìœ„ì¹˜ ì„¤ì •</div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">í™ˆ/í”½/ë¶„ë¥˜ ìœ„ì¹˜ ì¢Œí‘œ (mm)</div>
                <div style="padding: 15px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                    <div style="padding: 12px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                        <div style="color: #00d4ff; font-weight: bold; margin-bottom: 8px; font-size: 0.85em;">ğŸ  HOME</div>
                        <div style="color: #888; font-size: 0.75em; font-family: monospace;">
                            X:367.5 Y:4.0 Z:203.2
                        </div>
                    </div>
                    <div style="padding: 12px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                        <div style="color: #e74c3c; font-weight: bold; margin-bottom: 8px; font-size: 0.85em;">ğŸ“¥ PICK</div>
                        <div style="color: #888; font-size: 0.75em; font-family: monospace;">
                            X:652.4 Y:43.1 Z:157.6
                        </div>
                    </div>
                    <div style="padding: 12px; background: rgba(46, 204, 113, 0.1); border-radius: 8px; border: 1px solid rgba(46, 204, 113, 0.3);">
                        <div style="color: #2ecc71; font-weight: bold; margin-bottom: 8px; font-size: 0.85em;">ğŸ“¦ SMALL</div>
                        <div style="color: #888; font-size: 0.75em; font-family: monospace;">
                            X:208.6 Y:180.1
                        </div>
                    </div>
                    <div style="padding: 12px; background: rgba(241, 196, 15, 0.1); border-radius: 8px; border: 1px solid rgba(241, 196, 15, 0.3);">
                        <div style="color: #f1c40f; font-weight: bold; margin-bottom: 8px; font-size: 0.85em;">ğŸ“¦ MEDIUM</div>
                        <div style="color: #888; font-size: 0.75em; font-family: monospace;">
                            X:399.3 Y:180.2
                        </div>
                    </div>
                    <div style="padding: 12px; background: rgba(231, 76, 60, 0.1); border-radius: 8px; border: 1px solid rgba(231, 76, 60, 0.3);">
                        <div style="color: #e74c3c; font-weight: bold; margin-bottom: 8px; font-size: 0.85em;">ğŸ“¦ LONG</div>
                        <div style="color: #888; font-size: 0.75em; font-family: monospace;">
                            X:589.98 Y:180.2
                        </div>
                    </div>
                    <div style="padding: 12px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                        <div style="color: #888; font-weight: bold; margin-bottom: 8px; font-size: 0.85em;">âš™ï¸ Force</div>
                        <div style="color: #888; font-size: 0.75em;">
                            ê°ì§€: 30N / ì•ˆì „Z: 12.5mm
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ’¾ ë°ì´í„° íƒ­ (ì‹¤ì‹œê°„ ìƒíƒœ & ì´ë²¤íŠ¸) -->
    <div id="recovery" class="tab-content">
        <!-- ğŸ“Š ì‹¤ì‹œê°„ ìƒíƒœ ìš”ì•½ í…Œì´ë¸” -->
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <div class="card-title">ğŸ“Š ì‹¤ì‹œê°„ ìƒíƒœ ìš”ì•½</div>
                    <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">Firebase ì—°ë™ ë°ì´í„° ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§</div>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button id="btn-test-recovery" class="btn" style="background: linear-gradient(135deg, #9b59b6, #8e44ad); font-size: 0.85em; padding: 8px 16px;">
                        ğŸ§ª ë³µêµ¬ í…ŒìŠ¤íŠ¸
                    </button>
                    <button id="btn-reset-all" class="btn" style="background: linear-gradient(135deg, #e74c3c, #c0392b); font-size: 0.85em; padding: 8px 16px;">
                        ğŸ—‘ï¸ ì´ˆê¸°í™”
                    </button>
                </div>
            </div>
            <div style="padding: 15px;">
                <table style="width: 100%; border-collapse: collapse; background: rgba(0,0,0,0.3); border-radius: 8px; overflow: hidden;">
                    <thead>
                        <tr style="background: rgba(0,212,255,0.15);">
                            <th style="padding: 12px; text-align: center; color: #00d4ff; font-size: 0.85em; border-bottom: 1px solid rgba(255,255,255,0.1);">ë¡œë´‡ ìƒíƒœ</th>
                            <th style="padding: 12px; text-align: center; color: #00d4ff; font-size: 0.85em; border-bottom: 1px solid rgba(255,255,255,0.1);">ì‘ì—… ë‹¨ê³„</th>
                            <th style="padding: 12px; text-align: center; color: #00d4ff; font-size: 0.85em; border-bottom: 1px solid rgba(255,255,255,0.1);">ê·¸ë¦¬í¼</th>
                            <th style="padding: 12px; text-align: center; color: #2ecc71; font-size: 0.85em; border-bottom: 1px solid rgba(255,255,255,0.1);">S</th>
                            <th style="padding: 12px; text-align: center; color: #f1c40f; font-size: 0.85em; border-bottom: 1px solid rgba(255,255,255,0.1);">M</th>
                            <th style="padding: 12px; text-align: center; color: #e74c3c; font-size: 0.85em; border-bottom: 1px solid rgba(255,255,255,0.1);">L</th>
                            <th style="padding: 12px; text-align: center; color: #00d4ff; font-size: 0.85em; border-bottom: 1px solid rgba(255,255,255,0.1);">ë§ˆì§€ë§‰ ë¶„ë¥˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id="data-summary-row">
                            <td style="padding: 12px; text-align: center;">
                                <span id="data-robot-status" style="font-weight: bold; color: #00b894;">â—</span>
                                <span id="data-robot-status-text" style="color: #888; font-size: 0.9em; margin-left: 5px;">ëŒ€ê¸°</span>
                            </td>
                            <td style="padding: 12px; text-align: center;">
                                <span id="data-current-action" style="font-weight: bold; color: #3498db; font-size: 1.1em;">idle</span>
                            </td>
                            <td style="padding: 12px; text-align: center;">
                                <span id="data-gripper-status" style="font-size: 1.2em;">ğŸ”“</span>
                            </td>
                            <td style="padding: 12px; text-align: center;">
                                <span id="data-small-count" style="font-weight: bold; color: #2ecc71; font-size: 1.2em;">0</span>
                            </td>
                            <td style="padding: 12px; text-align: center;">
                                <span id="data-medium-count" style="font-weight: bold; color: #f1c40f; font-size: 1.2em;">0</span>
                            </td>
                            <td style="padding: 12px; text-align: center;">
                                <span id="data-long-count" style="font-weight: bold; color: #e74c3c; font-size: 1.2em;">0</span>
                            </td>
                            <td style="padding: 12px; text-align: center;">
                                <span id="data-last-class" style="font-weight: bold; color: #fdcb6e;">--</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ğŸ“‹ ìµœê·¼ ì´ë²¤íŠ¸ (ìµœëŒ€ 10ê°œ) -->
        <div class="card" style="margin-top: 15px;">
            <div class="card-title">ğŸ“‹ ìµœê·¼ ì´ë²¤íŠ¸ <span style="color: #888; font-size: 0.8em; font-weight: normal;">(ìµœëŒ€ 10ê°œ, ìë™ ê°±ì‹ )</span></div>
            <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ë¶„ë¥˜ ì‘ì—… ì´ë²¤íŠ¸ ì´ë ¥ (FIFO)</div>
            <div style="padding: 15px;">
                <table style="width: 100%; border-collapse: collapse; background: rgba(0,0,0,0.3); border-radius: 8px; overflow: hidden;">
                    <thead>
                        <tr style="background: rgba(52,152,219,0.15);">
                            <th style="padding: 10px 12px; text-align: left; color: #3498db; font-size: 0.8em; width: 100px;">ì‹œê°„</th>
                            <th style="padding: 10px 12px; text-align: center; color: #3498db; font-size: 0.8em; width: 100px;">ì´ë²¤íŠ¸</th>
                            <th style="padding: 10px 12px; text-align: left; color: #3498db; font-size: 0.8em;">ìƒì„¸ ë‚´ìš©</th>
                        </tr>
                    </thead>
                    <tbody id="data-event-tbody">
                        <tr class="event-row" style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                            <td style="padding: 10px 12px; color: #888; font-family: monospace; font-size: 0.85em;">--:--:--</td>
                            <td style="padding: 10px 12px; text-align: center;"><span style="padding: 3px 8px; border-radius: 4px; background: rgba(136,136,136,0.2); color: #888; font-size: 0.8em;">ëŒ€ê¸°</span></td>
                            <td style="padding: 10px 12px; color: #888; font-size: 0.9em;">ì‹œìŠ¤í…œ ëŒ€ê¸°ì¤‘...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- ğŸ”§ ì‹œìŠ¤í…œ ë³µêµ¬ ì •ë³´ + Firebase ìƒíƒœ -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
            <!-- ì‹œìŠ¤í…œ ë³µêµ¬ ì •ë³´ -->
            <div class="card">
                <div class="card-title">ğŸ”§ ì‹œìŠ¤í…œ ë³µêµ¬ ì •ë³´</div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ì¬ì‹œì‘/í¬ë˜ì‹œ ê¸°ë¡ ë° ë³µêµ¬ ìƒíƒœ</div>
                <div style="padding: 15px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div style="padding: 12px; background: rgba(0,0,0,0.3); border-radius: 8px; text-align: center;">
                            <div style="color: #888; font-size: 0.8em;">ì‹œìŠ¤í…œ ì¬ì‹œì‘</div>
                            <div id="recovery-restart-count" style="font-size: 1.5em; font-weight: bold; color: #f39c12;">0</div>
                        </div>
                        <div style="padding: 12px; background: rgba(0,0,0,0.3); border-radius: 8px; text-align: center;">
                            <div style="color: #888; font-size: 0.8em;">ë§ˆì§€ë§‰ í¬ë˜ì‹œ</div>
                            <div id="recovery-crash-reason" style="font-size: 0.9em; font-weight: bold; color: #e74c3c; margin-top: 5px;">ì—†ìŒ</div>
                        </div>
                    </div>
                    <div style="margin-top: 10px; padding: 12px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                        <div style="color: #888; font-size: 0.8em; margin-bottom: 5px;">ëª©í‘œ Place ìœ„ì¹˜</div>
                        <div id="recovery-target-place" style="color: #00d4ff; font-size: 0.85em; font-family: monospace;">--</div>
                    </div>
                </div>
            </div>
            
            <!-- Firebase ìƒíƒœ -->
            <div class="card">
                <div class="card-title">ğŸ“Š Firebase ì—°ê²°</div>
                <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">í´ë¼ìš°ë“œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ ìƒíƒœ</div>
                <div style="padding: 15px;">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <div style="padding: 12px; background: rgba(0,212,255,0.1); border-radius: 8px; text-align: center; border: 1px solid rgba(0,212,255,0.3);">
                            <div style="color: #888; font-size: 0.8em;">ë§ˆì§€ë§‰ ì—…ë¡œë“œ</div>
                            <div id="firebase-last-upload" style="font-size: 0.9em; font-weight: bold; color: #00d4ff; margin-top: 5px;">--:--:--</div>
                        </div>
                        <div style="padding: 12px; background: rgba(46,204,113,0.1); border-radius: 8px; text-align: center; border: 1px solid rgba(46,204,113,0.3);">
                            <div style="color: #888; font-size: 0.8em;">ì´ ë ˆì½”ë“œ</div>
                            <div id="firebase-total-records" style="font-size: 1.1em; font-weight: bold; color: #2ecc71; margin-top: 5px;">--</div>
                        </div>
                        <div style="padding: 12px; background: rgba(0,0,0,0.3); border-radius: 8px; text-align: center;">
                            <div style="color: #888; font-size: 0.8em;">ì—…ë¡œë“œ ê°„ê²©</div>
                            <div style="font-size: 0.9em; font-weight: bold; color: #888; margin-top: 5px;">1ì´ˆ</div>
                        </div>
                        <div style="padding: 12px; background: rgba(0,0,0,0.3); border-radius: 8px; text-align: center;">
                            <div style="color: #888; font-size: 0.8em;">ì—°ê²° ìƒíƒœ</div>
                            <div id="firebase-connection" style="font-size: 0.9em; font-weight: bold; color: #00b894; margin-top: 5px;">ì—°ê²°ë¨</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ğŸ“„ Firebase Raw JSON ë·°ì–´ -->
        <div class="card" style="margin-top: 15px;">
            <div class="card-title">ğŸ“„ Firebase ìµœì‹  ë°ì´í„° (Raw JSON)</div>
            <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">Firebase ì „ì†¡ ë°ì´í„° ì›ë³¸ í™•ì¸</div>
            <div style="padding: 15px;">
                <div style="background: rgba(0,0,0,0.5); border-radius: 8px; padding: 15px; font-family: 'Consolas', 'Monaco', monospace; font-size: 0.8em; max-height: 250px; overflow-y: auto; border: 1px solid rgba(0,212,255,0.2);">
                    <pre id="firebase-raw-json" style="color: #00d4ff; white-space: pre-wrap; margin: 0;">{
  "timestamp": "--",
  "robot_state": "ëŒ€ê¸° ì¤‘..."
}</pre>
                </div>
                <div style="margin-top: 8px; display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: #888; font-size: 0.75em;">ğŸ’¡ 1ì´ˆë§ˆë‹¤ ìë™ ê°±ì‹  (ì„±ëŠ¥ ì˜í–¥ ì—†ìŒ)</span>
                    <span id="firebase-json-size" style="color: #888; font-size: 0.75em;">-- bytes</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ§± ì ì¬ íƒ­ (í…ŒíŠ¸ë¦¬ìŠ¤) -->
    <div id="stacking" class="tab-content">
        <!-- ì œì–´ ì¹´ë“œ -->
        <div class="card">
            <div class="card-title">ğŸ§± 2ì°¨ ì ì¬ (í…ŒíŠ¸ë¦¬ìŠ¤)</div>
            <div style="color: #888; font-size: 0.75em; margin-bottom: 12px;">ë¶„ë¥˜ ì™„ë£Œëœ ë°•ìŠ¤ë¥¼ í…ŒíŠ¸ë¦¬ìŠ¤ ë°©ì‹ìœ¼ë¡œ ì ì¬</div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                <button class="btn" id="btn-stacking-start" style="padding: 15px; font-size: 1.1em; background: linear-gradient(135deg, #4caf50, #388e3c);">
                    ğŸ“¦ ì ì¬ ì‹œì‘
                </button>
                <button class="btn" id="btn-stacking-stop" style="padding: 15px; font-size: 1.1em; background: linear-gradient(135deg, #f44336, #c62828);">
                    â¹ï¸ ì ì¬ ì •ì§€
                </button>
            </div>
            
            <div id="stacking-message" style="padding: 10px; background: #1a1a2e; border-radius: 6px; text-align: center; color: #888;">
                ëŒ€ê¸° ì¤‘...
            </div>
        </div>
        
        <!-- ì ì¬ ìˆœì„œ ì•ˆë‚´ -->
        <div class="card">
            <div class="card-title">ğŸ“‹ ì ì¬ ìˆœì„œ</div>
            <div style="color: #888; font-size: 0.75em; margin-bottom: 12px;">ì´ 6ê°œ ë°•ìŠ¤ ì¬ë°°ì¹˜</div>
            
            <div id="stacking-sequence" style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px;">
                <div class="stacking-step" data-step="1" style="padding: 12px; background: #2d2d44; border-radius: 8px; text-align: center; border: 2px solid #333;">
                    <div style="font-size: 0.7em; color: #888;">#1</div>
                    <div style="font-size: 1.2em; margin: 5px 0;">ğŸŸ¨</div>
                    <div style="font-size: 0.8em; color: #ffc107;">MEDIUM</div>
                </div>
                <div class="stacking-step" data-step="2" style="padding: 12px; background: #2d2d44; border-radius: 8px; text-align: center; border: 2px solid #333;">
                    <div style="font-size: 0.7em; color: #888;">#2</div>
                    <div style="font-size: 1.2em; margin: 5px 0;">ğŸŸ¥</div>
                    <div style="font-size: 0.8em; color: #f44336;">LARGE</div>
                </div>
                <div class="stacking-step" data-step="3" style="padding: 12px; background: #2d2d44; border-radius: 8px; text-align: center; border: 2px solid #333;">
                    <div style="font-size: 0.7em; color: #888;">#3</div>
                    <div style="font-size: 1.2em; margin: 5px 0;">ğŸŸ¥</div>
                    <div style="font-size: 0.8em; color: #f44336;">LARGE</div>
                </div>
                <div class="stacking-step" data-step="4" style="padding: 12px; background: #2d2d44; border-radius: 8px; text-align: center; border: 2px solid #333;">
                    <div style="font-size: 0.7em; color: #888;">#4</div>
                    <div style="font-size: 1.2em; margin: 5px 0;">ğŸŸ¨</div>
                    <div style="font-size: 0.8em; color: #ffc107;">MEDIUM</div>
                </div>
                <div class="stacking-step" data-step="5" style="padding: 12px; background: #2d2d44; border-radius: 8px; text-align: center; border: 2px solid #333;">
                    <div style="font-size: 0.7em; color: #888;">#5</div>
                    <div style="font-size: 1.2em; margin: 5px 0;">ğŸŸ©</div>
                    <div style="font-size: 0.8em; color: #4caf50;">SMALL</div>
                </div>
                <div class="stacking-step" data-step="6" style="padding: 12px; background: #2d2d44; border-radius: 8px; text-align: center; border: 2px solid #333;">
                    <div style="font-size: 0.7em; color: #888;">#6</div>
                    <div style="font-size: 1.2em; margin: 5px 0;">ğŸŸ©</div>
                    <div style="font-size: 0.8em; color: #4caf50;">SMALL</div>
                </div>
            </div>
        </div>
        
        <!-- ì ì¬ ì§„í–‰ ìƒíƒœ -->
        <div class="card">
            <div class="card-title">ğŸ“Š ì§„í–‰ ìƒíƒœ</div>
            <div style="color: #888; font-size: 0.75em; margin-bottom: 12px;">í˜„ì¬ ì ì¬ ì§„í–‰ë¥ </div>
            
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; text-align: center;">
                <div style="padding: 15px; background: #1a1a2e; border-radius: 8px;">
                    <div style="font-size: 0.8em; color: #888; margin-bottom: 5px;">ë‹¨ê³„</div>
                    <div id="stacking-phase" style="font-size: 1.3em; font-weight: bold; color: #9c27b0;">IDLE</div>
                </div>
                <div style="padding: 15px; background: #1a1a2e; border-radius: 8px;">
                    <div style="font-size: 0.8em; color: #888; margin-bottom: 5px;">ì§„í–‰</div>
                    <div style="font-size: 1.3em; font-weight: bold;"><span id="stacking-current">0</span> / 6</div>
                </div>
                <div style="padding: 15px; background: #1a1a2e; border-radius: 8px;">
                    <div style="font-size: 0.8em; color: #888; margin-bottom: 5px;">ì§„í–‰ë¥ </div>
                    <div id="stacking-progress" style="font-size: 1.3em; font-weight: bold; color: #4caf50;">0%</div>
                </div>
            </div>
            
            <!-- í”„ë¡œê·¸ë ˆìŠ¤ ë°” -->
            <div style="margin-top: 15px; background: #1a1a2e; border-radius: 8px; height: 20px; overflow: hidden;">
                <div id="stacking-progress-bar" style="height: 100%; width: 0%; background: linear-gradient(90deg, #9c27b0, #e91e63); transition: width 0.3s;"></div>
            </div>
        </div>
        
        <!-- ì ì¬ ë¡œê·¸ -->
        <div class="card">
            <div class="card-title">ğŸ“ ì ì¬ ë¡œê·¸</div>
            <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ìµœê·¼ ì‘ì—… ì´ë²¤íŠ¸</div>
            <div id="stacking-log" style="max-height: 150px; overflow-y: auto; font-family: monospace; font-size: 0.85em; padding: 10px; background: #0d0d1a; border-radius: 6px;">
                <div style="color: #666;">ì ì¬ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
            </div>
        </div>
    </div>

    <!-- ğŸš§ ì‘ì—… ì˜ì—­ íƒ­ -->
    <div id="workspace" class="tab-content">
        <div class="card">
            <div class="card-title">ğŸš§ ì‘ì—… ì˜ì—­ ì„¤ì •</div>
            <div style="color: #888; font-size: 0.75em; margin-bottom: 8px;">ë¡œë´‡ ì•ˆì „ êµ¬ì—­ ë° ì œí•œ ì„¤ì •</div>
            <div style="padding: 40px; text-align: center;">
                <div style="font-size: 3em; margin-bottom: 20px;">ğŸ›¡ï¸</div>
                <div style="color: #888; font-size: 1.1em;">ì•ˆì „ ì˜ì—­ ì„¤ì • ì¤€ë¹„ ì¤‘</div>
                <div style="color: #666; font-size: 0.9em; margin-top: 10px;">ë¡œë´‡ ì‘ì—… ì˜ì—­ ë° ì•ˆì „ êµ¬ì—­ ê´€ë ¨ ì„¤ì •ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
            </div>
        </div>
    </div>

    <script>
        // Socket.IO ì—°ê²°
        const socket = io();
        
        // â˜… íƒ­ ì „í™˜ (ë“œë¡­ë‹¤ìš´ ì„œë¸Œíƒ­ ì§€ì›)
        function switchTab(tabId) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-dropdown-item').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            const tabContent = document.getElementById(tabId);
            if (tabContent) {
                tabContent.classList.add('active');
            }
            
            // í•´ë‹¹ ë²„íŠ¼ í™œì„±í™”
            const mainBtn = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
            const dropdownItem = document.querySelector(`.tab-dropdown-item[data-tab="${tabId}"]`);
            
            if (mainBtn) {
                mainBtn.classList.add('active');
            } else if (dropdownItem) {
                dropdownItem.classList.add('active');
                // ë“œë¡­ë‹¤ìš´ ë¶€ëª¨ ë²„íŠ¼ë„ í™œì„±í™” í‘œì‹œ
                document.getElementById('settings-tab-btn').classList.add('active');
            }
        }
        
        // ë©”ì¸ íƒ­ ë²„íŠ¼ í´ë¦­
        document.querySelectorAll('.tab-btn[data-tab]').forEach(btn => {
            btn.addEventListener('click', () => {
                switchTab(btn.dataset.tab);
            });
        });
        
        // ë“œë¡­ë‹¤ìš´ ì„œë¸Œíƒ­ í´ë¦­
        document.querySelectorAll('.tab-dropdown-item').forEach(item => {
            item.addEventListener('click', () => {
                switchTab(item.dataset.tab);
            });
        });
        
        // ì°¨íŠ¸ ì„¤ì •
        const chartData = {
            labels: [],
            datasets: []
        };
        
        const jointColors = ['#ff6384', '#36a2eb', '#ffce56', '#4bc0c0', '#9966ff', '#ff9f40'];
        
        for (let i = 0; i < 6; i++) {
            chartData.datasets.push({
                label: `J${i + 1}`,
                data: [],
                borderColor: jointColors[i],
                backgroundColor: jointColors[i] + '20',
                fill: false,
                tension: 0.4,
                pointRadius: 0,
                borderWidth: 2
            });
        }
        
        const ctx = document.getElementById('joint-chart').getContext('2d');
        const jointChart = new Chart(ctx, {
            type: 'line',
            data: chartData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false,
                scales: {
                    x: { display: false },
                    y: {
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: '#888' }
                    }
                },
                plugins: {
                    legend: {
                        labels: { color: '#888', usePointStyle: true, pointStyle: 'circle' }
                    }
                }
            }
        });
        
        // ì—°ê²° ìƒíƒœ
        socket.on('connect', () => updateConnectionStatus(true));
        socket.on('disconnect', () => updateConnectionStatus(false));
        
        function updateConnectionStatus(connected) {
            const el = document.getElementById('connection-status');
            if (connected) {
                el.className = 'status-badge status-connected';
                el.innerHTML = '<span>ğŸŸ¢</span><span>ì—°ê²°ë¨</span>';
            } else {
                el.className = 'status-badge status-disconnected';
                el.innerHTML = '<span>ğŸ”´</span><span>ì—°ê²° ì•ˆë¨</span>';
            }
        }
        
        // ë¡œë´‡ ìƒíƒœ ìˆ˜ì‹ 
        socket.on('robot_state', (d) => {
            updateOverview(d);
            updateJoints(d);
            updateTCP(d);
            updateIO(d);
            updateSystem(d);
            updateChart(d);
            updateGripperStatus(d);  // ê·¸ë¦¬í¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        });
        
        socket.on('task_status', (d) => {
            document.getElementById('task-completed').textContent = d.completed || 0;
            document.getElementById('task-errors').textContent = d.errors || 0;
            document.getElementById('task-rate').textContent = d.rate_per_hour || 0;
            document.getElementById('task-queue').textContent = d.queue?.length || 0;
        });
        
        socket.on('logs', (logs) => {
            updateLogs(logs);
        });
        
        // ê°œìš” ì—…ë°ì´íŠ¸
        function updateOverview(d) {
            const modes = ['MANUAL', 'AUTONOMOUS'];
            const states = ['INIT', 'STANDBY', 'MOVING', 'SAFE_OFF', 'TEACHING', 'SAFE_STOP', 'EMERGENCY', 'HOLD'];
            
            document.getElementById('ov-mode').textContent = modes[d.robot_mode] || 'UNKNOWN';
            document.getElementById('ov-state').textContent = states[d.robot_state] || 'UNKNOWN';
            document.getElementById('ov-speed').textContent = (d.operation_speed_rate || 0) + '%';
            document.getElementById('ov-singularity').textContent = (d.singularity || 0).toFixed(3);
            
            const tcp = d.actual_tcp_position || [0,0,0,0,0,0];
            document.getElementById('ov-x').textContent = tcp[0].toFixed(1);
            document.getElementById('ov-y').textContent = tcp[1].toFixed(1);
            document.getElementById('ov-z').textContent = tcp[2].toFixed(1);
            
            const force = d.external_tcp_force || [0,0,0,0,0,0];
            document.getElementById('ov-fz').textContent = force[2].toFixed(1);
            
            const temps = d.joint_temperature || [25,25,25,25,25,25];
            const maxTemp = Math.max(...temps);
            const maxIdx = temps.indexOf(maxTemp);
            const tempEl = document.getElementById('ov-max-temp');
            tempEl.textContent = maxTemp.toFixed(1) + 'Â°C';
            tempEl.className = maxTemp > 60 ? 'temp-danger' : maxTemp > 45 ? 'temp-warn' : 'temp-normal';
            document.getElementById('ov-max-temp-joint').textContent = maxIdx + 1;
            
            // í—¤ë” ì—…ë°ì´íŠ¸
            const rt = d.running_time || 0;
            const h = Math.floor(rt / 3600);
            const m = Math.floor((rt % 3600) / 60);
            const s = Math.floor(rt % 60);
            document.getElementById('running-time').textContent = `â±ï¸ ${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            document.getElementById('program-status').textContent = d.program_running ? 'ğŸ“‹ ì‹¤í–‰ì¤‘' : 'ğŸ“‹ ëŒ€ê¸°';
        }
        
        // ì¡°ì¸íŠ¸ ì—…ë°ì´íŠ¸
        function updateJoints(d) {
            // Actual í…Œì´ë¸”
            let actualHtml = '';
            for (let i = 0; i < 6; i++) {
                actualHtml += `<tr>
                    <td class="label">J${i+1}</td>
                    <td>${(d.actual_joint_position?.[i] || 0).toFixed(2)}</td>
                    <td>${(d.actual_joint_velocity?.[i] || 0).toFixed(2)}</td>
                    <td>${(d.actual_joint_torque?.[i] || 0).toFixed(2)}</td>
                    <td>${(d.actual_motor_torque?.[i] || 0).toFixed(2)}</td>
                    <td>${(d.actual_je?.[i] || 0).toFixed(2)}</td>
                </tr>`;
            }
            document.getElementById('actual-joint-table').innerHTML = actualHtml;
            
            // Target í…Œì´ë¸”
            let targetHtml = '';
            for (let i = 0; i < 6; i++) {
                const diff = (d.actual_joint_position?.[i] || 0) - (d.target_joint_position?.[i] || 0);
                targetHtml += `<tr>
                    <td class="label">J${i+1}</td>
                    <td>${(d.target_joint_position?.[i] || 0).toFixed(2)}</td>
                    <td>${(d.target_joint_velocity?.[i] || 0).toFixed(2)}</td>
                    <td style="color: ${Math.abs(diff) > 1 ? '#fdcb6e' : '#00b894'}">${diff.toFixed(3)}</td>
                </tr>`;
            }
            document.getElementById('target-joint-table').innerHTML = targetHtml;
            
            // ì˜¨ë„
            let tempHtml = '';
            for (let i = 0; i < 6; i++) {
                const t = d.joint_temperature?.[i] || 25;
                const cls = t > 60 ? 'temp-danger' : t > 45 ? 'temp-warn' : 'temp-normal';
                tempHtml += `<td class="${cls}">${t.toFixed(1)}Â°C</td>`;
            }
            document.getElementById('temp-row').innerHTML = tempHtml;
            
            // ë¸Œë ˆì´í¬
            const brakeRow = document.getElementById('brake-row');
            let brakeHtml = '<td class="label">ë¸Œë ˆì´í¬</td>';
            for (let i = 0; i < 6; i++) {
                const bk = d.actual_bk?.[i] || 0;
                brakeHtml += `<td class="${bk ? 'brake-on' : 'brake-off'}">${bk ? 'ON' : 'OFF'}</td>`;
            }
            brakeRow.innerHTML = brakeHtml;
            
            // ì ˆëŒ€ ìœ„ì¹˜
            const absRow = document.getElementById('abs-pos-row');
            let absHtml = '<td class="label">ì ˆëŒ€ìœ„ì¹˜</td>';
            for (let i = 0; i < 6; i++) {
                absHtml += `<td>${(d.actual_joint_position_abs?.[i] || 0).toFixed(1)}</td>`;
            }
            absRow.innerHTML = absHtml;
        }
        
        // TCP ì—…ë°ì´íŠ¸
        function updateTCP(d) {
            const labels = ['X', 'Y', 'Z', 'A', 'B', 'C'];
            const units = ['mm', 'mm', 'mm', 'Â°', 'Â°', 'Â°'];
            
            // Actual TCP
            let actualTcpHtml = '';
            for (let i = 0; i < 6; i++) {
                actualTcpHtml += `<div class="tcp-item">
                    <div class="tcp-label">${labels[i]}</div>
                    <div class="tcp-value">${(d.actual_tcp_position?.[i] || 0).toFixed(2)}</div>
                    <div class="tcp-unit">${units[i]}</div>
                </div>`;
            }
            document.getElementById('actual-tcp').innerHTML = actualTcpHtml;
            
            // Target TCP (Desired)
            let targetTcpHtml = '';
            for (let i = 0; i < 6; i++) {
                const actualVal = d.actual_tcp_position?.[i] || 0;
                const desiredVal = d.desired_tcp_position?.[i] || 0;
                const diff = Math.abs(actualVal - desiredVal);
                const diffClass = diff > 1 ? 'tcp-diff-warn' : '';
                targetTcpHtml += `<div class="tcp-item ${diffClass}">
                    <div class="tcp-label">${labels[i]}</div>
                    <div class="tcp-value">${desiredVal.toFixed(2)}</div>
                    <div class="tcp-unit">${units[i]}</div>
                </div>`;
            }
            document.getElementById('target-tcp').innerHTML = targetTcpHtml;
            
            // ë¹„êµ í…Œì´ë¸” ì—…ë°ì´íŠ¸
            updateTcpCompareTable(d);
            
            // TCP ì†ë„
            const velLabels = ['Vx', 'Vy', 'Vz', 'Wa', 'Wb', 'Wc'];
            const velUnits = ['mm/s', 'mm/s', 'mm/s', 'Â°/s', 'Â°/s', 'Â°/s'];
            
            let actualVelHtml = '';
            for (let i = 0; i < 6; i++) {
                actualVelHtml += `<div class="tcp-item">
                    <div class="tcp-label">${velLabels[i]}</div>
                    <div class="tcp-value">${(d.actual_tcp_velocity?.[i] || 0).toFixed(2)}</div>
                    <div class="tcp-unit">${velUnits[i]}</div>
                </div>`;
            }
            document.getElementById('actual-tcp-vel').innerHTML = actualVelHtml;
            
            let targetVelHtml = '';
            for (let i = 0; i < 6; i++) {
                targetVelHtml += `<div class="tcp-item">
                    <div class="tcp-label">${velLabels[i]}</div>
                    <div class="tcp-value">${(d.desired_tcp_velocity?.[i] || 0).toFixed(2)}</div>
                    <div class="tcp-unit">${velUnits[i]}</div>
                </div>`;
            }
            document.getElementById('target-tcp-vel').innerHTML = targetVelHtml;
            
            // í˜/í† í¬ ë°” ê·¸ë˜í”„
            updateForceBar('external-force', d.external_tcp_force || [0,0,0,0,0,0]);
            updateForceBar('actual-tool-force', d.actual_tool_force || [0,0,0,0,0,0]);
            updateForceBar('target-force', d.target_force || [0,0,0,0,0,0]);
        }
        
        // TCP ë¹„êµ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateTcpCompareTable(d) {
            const labels = ['X', 'Y', 'Z', 'A', 'B', 'C'];
            const units = ['mm', 'mm', 'mm', 'Â°', 'Â°', 'Â°'];
            const tbody = document.getElementById('tcp-compare-table');
            
            const actual = d.actual_tcp_position || [0,0,0,0,0,0];
            const desired = d.desired_tcp_position || [0,0,0,0,0,0];
            
            let html = '';
            for (let i = 0; i < 6; i++) {
                const actualVal = actual[i] || 0;
                const desiredVal = desired[i] || 0;
                const diff = actualVal - desiredVal;
                const absDiff = Math.abs(diff);
                
                // ì°¨ì´ì— ë”°ë¥¸ ìƒ‰ìƒ ê²°ì •
                let diffColor = '#00b894';  // ë…¹ìƒ‰ (ì •ìƒ)
                if (absDiff > 5) diffColor = '#d63031';  // ë¹¨ê°„ìƒ‰ (í° ì°¨ì´)
                else if (absDiff > 1) diffColor = '#fdcb6e';  // ë…¸ë€ìƒ‰ (ì£¼ì˜)
                
                const diffSign = diff >= 0 ? '+' : '';
                
                html += `<tr>
                    <td style="color: #00d4ff; font-weight: bold;">${labels[i]}</td>
                    <td>${actualVal.toFixed(2)}</td>
                    <td>${desiredVal.toFixed(2)}</td>
                    <td style="color: ${diffColor}; font-weight: bold;">${diffSign}${diff.toFixed(2)}</td>
                    <td style="color: #888;">${units[i]}</td>
                </tr>`;
            }
            
            tbody.innerHTML = html;
        }
        
        function updateForceBar(containerId, forces) {
            const labels = ['Fx', 'Fy', 'Fz', 'Tx', 'Ty', 'Tz'];
            const maxVal = 50;
            let html = '';
            
            for (let i = 0; i < 6; i++) {
                const val = forces[i] || 0;
                const pct = Math.min(Math.abs(val) / maxVal * 100, 100);
                const color = val < 0 ? '#ff6384' : '#00d4ff';
                html += `<div class="force-bar-wrapper">
                    <div class="force-bar-bg">
                        <div class="force-bar" style="height: ${Math.max(pct, 3)}%; background: ${color};"></div>
                    </div>
                    <div class="force-label">${labels[i]}</div>
                    <div class="force-value">${val.toFixed(1)}</div>
                </div>`;
            }
            document.getElementById(containerId).innerHTML = html;
        }
        
        // I/O ì—…ë°ì´íŠ¸
        function updateIO(d) {
            // Controller Digital I/O (16bit) - ë²ˆí˜¸ëŠ” 1~16ìœ¼ë¡œ í‘œì‹œ (í‹°ì¹­íœë˜íŠ¸ì™€ ë™ì¼)
            let dinHtml = '';
            let doutHtml = '';
            for (let i = 0; i < 16; i++) {
                const inBit = (d.controller_digital_input >> i) & 1;
                const outBit = (d.controller_digital_output >> i) & 1;
                const displayNum = i + 1;  // 1~16ìœ¼ë¡œ í‘œì‹œ
                dinHtml += `<div class="io-bit ${inBit ? 'io-on' : 'io-off'}">${displayNum}</div>`;
                doutHtml += `<div class="io-bit ${outBit ? 'io-on' : 'io-off'}">${displayNum}</div>`;
            }
            document.getElementById('ctrl-din').innerHTML = dinHtml;
            document.getElementById('ctrl-dout').innerHTML = doutHtml;
            
            // Controller Analog
            const ain = d.controller_analog_input || [0, 0];
            const aout = d.controller_analog_output || [0, 0];
            document.getElementById('ctrl-ain0').textContent = ain[0].toFixed(2) + ' V';
            document.getElementById('ctrl-ain1').textContent = ain[1].toFixed(2) + ' V';
            document.getElementById('ctrl-aout0').textContent = aout[0].toFixed(2) + ' V';
            document.getElementById('ctrl-aout1').textContent = aout[1].toFixed(2) + ' V';
            
            // Flange Digital
            document.getElementById('flange-din').textContent = d.flange_digital_input || 0;
            document.getElementById('flange-dout').textContent = d.flange_digital_output || 0;
            
            // Flange Analog
            const fain = d.flange_analog_input || [0, 0, 0, 0];
            for (let i = 0; i < 4; i++) {
                document.getElementById(`flange-ain${i}`).textContent = fain[i].toFixed(2) + ' V';
            }
        }
        
        // ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸
        function updateSystem(d) {
            const modes = ['MANUAL', 'AUTONOMOUS'];
            const states = ['INIT', 'STANDBY', 'MOVING', 'SAFE_OFF', 'TEACHING', 'SAFE_STOP', 'EMERGENCY', 'HOLD'];
            
            document.getElementById('sys-mode').textContent = modes[d.robot_mode] || 'UNKNOWN';
            document.getElementById('sys-state').textContent = states[d.robot_state] || 'UNKNOWN';
            document.getElementById('sys-speed').textContent = (d.operation_speed_rate || 0) + '%';
            
            // ë™ì‘ ìƒíƒœ í‘œì‹œ ë° ë²„íŠ¼ ì œì–´
            const isMoving = d.robot_state === 2; // MOVING
            const movingStatus = document.getElementById('moving-status-local');
            
            if (isMoving) {
                movingStatus.style.display = 'block';
            } else {
                movingStatus.style.display = 'none';
            }
            
            // ìŠ¬ë¼ì´ë” ë™ê¸°í™” (ë“œë˜ê·¸ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ)
            if (!window.isSpeedSliderDragging) {
                const slider = document.getElementById('speed-slider');
                const currentSpeed = d.operation_speed_rate || 0;
                slider.value = currentSpeed;
                document.getElementById('speed-display').textContent = currentSpeed;
            }
            document.getElementById('sys-singularity').textContent = (d.singularity || 0).toFixed(4);
            document.getElementById('sys-solution').textContent = d.solution_space || 0;
            document.getElementById('sys-access').textContent = d.access_control || 0;
            
            document.getElementById('sys-program').textContent = d.program_running ? 'ì‹¤í–‰ì¤‘' : 'ì •ì§€';
            document.getElementById('sys-program').className = 'status-value ' + (d.program_running ? 'active' : '');
            
            const rt = d.running_time || 0;
            document.getElementById('sys-runtime').textContent = rt.toFixed(1) + 's';
            
            document.getElementById('sys-safestop').textContent = d.safe_stop_reset_req ? 'í•„ìš”' : 'ì •ìƒ';
            document.getElementById('sys-safestop').className = 'status-value ' + (d.safe_stop_reset_req ? 'warning' : 'active');
            
            // Unix timestampë¥¼ í•œêµ­ì‹œê°„ HH:MM:SSë¡œ ë³€í™˜
            const ts = d.timestamp || 0;
            if (ts > 0) {
                const date = new Date(ts * 1000);  // Unix timestampëŠ” ì´ˆ ë‹¨ìœ„
                const kstTime = date.toLocaleTimeString('ko-KR', { 
                    timeZone: 'Asia/Seoul', 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    second: '2-digit',
                    hour12: false 
                });
                document.getElementById('sys-timestamp').textContent = kstTime;
            } else {
                document.getElementById('sys-timestamp').textContent = '--:--:--';
            }
            
            document.getElementById('sys-tool').textContent = d.tool_index ?? '--';
            document.getElementById('sys-tcp').textContent = d.tcp_index ?? '--';
            
            const g = d.gravity_dir || [0, 0, -9.81];
            document.getElementById('sys-gravity').textContent = `[${g[0].toFixed(2)}, ${g[1].toFixed(2)}, ${g[2].toFixed(2)}]`;
            
            document.getElementById('sys-error-level').textContent = d.error_level || 0;
            document.getElementById('sys-error-code').textContent = d.error_code || 0;
            document.getElementById('sys-error-msg').textContent = d.error_msg || '-';
        }
        
        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        let chartTime = 0;
        function updateChart(d) {
            chartTime++;
            chartData.labels.push(chartTime);
            
            for (let i = 0; i < 6; i++) {
                chartData.datasets[i].data.push(d.actual_joint_position?.[i] || 0);
            }
            
            if (chartData.labels.length > 100) {
                chartData.labels.shift();
                chartData.datasets.forEach(ds => ds.data.shift());
            }
            
            jointChart.update('none');
        }
        
        // ë¡œê·¸ ì—…ë°ì´íŠ¸
        function updateLogs(logs) {
            const list = document.getElementById('log-list');
            const ctrlList = document.getElementById('control-log-list');
            let html = '';
            
            logs.forEach(log => {
                const cls = {'INFO': 'log-info', 'WARN': 'log-warn', 'ERROR': 'log-error'}[log.level] || 'log-info';
                html += `<div class="log-item ${cls}">
                    <span class="log-time">${log.time}</span>
                    <span>${log.message}</span>
                </div>`;
            });
            
            list.innerHTML = html || '<div class="log-item log-info"><span class="log-time">--:--:--</span><span>ë¡œê·¸ ì—†ìŒ</span></div>';
            ctrlList.innerHTML = html;
        }
        
        // ê·¸ë¦¬í¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateGripperStatus(d) {
            const dout = d.controller_digital_output || 0;
            const do1 = (dout >> 0) & 1;  // bit 0: 1=ON(value=0), 0=OFF(value=1)
            const do2 = (dout >> 1) & 1;  // bit 1: 1=ON(value=0), 0=OFF(value=1)
            
            // ì—´ê¸°: DO1=ON(ë¹„íŠ¸1=1), DO2=OFF(ë¹„íŠ¸1=0)
            // ë‹«ê¸°: DO1=OFF(ë¹„íŠ¸1=0), DO2=ON(ë¹„íŠ¸1=1)
            const isOpen = (do1 === 1 && do2 === 0);
            const isClose = (do1 === 0 && do2 === 1);
            
            const statusDisplay = document.getElementById('gripper-status-display');
            const statusText = document.getElementById('gripper-status-text');
            const do1Status = document.getElementById('gripper-do1-status');
            const do2Status = document.getElementById('gripper-do2-status');
            
            if (statusDisplay) {
                if (isOpen) {
                    statusDisplay.textContent = 'ğŸ”“';
                    statusText.textContent = 'ì—´ë¦¼ (OPEN)';
                    statusText.style.color = '#00b894';
                } else if (isClose) {
                    statusDisplay.textContent = 'ğŸ”’';
                    statusText.textContent = 'ë‹«í˜ (CLOSE)';
                    statusText.style.color = '#00d4ff';
                } else {
                    statusDisplay.textContent = 'â“';
                    statusText.textContent = 'ì•Œ ìˆ˜ ì—†ìŒ';
                    statusText.style.color = '#888';
                }
            }
            
            if (do1Status) do1Status.textContent = do1 === 1 ? 'ON' : 'OFF';
            if (do2Status) do2Status.textContent = do2 === 1 ? 'ON' : 'OFF';
        }
        
        // ê·¸ë¦¬í¼ ì—´ê¸°
        document.getElementById('btn-gripper-open').addEventListener('click', () => {
            socket.emit('gripper_command', { command: 'open' });
        });
        
        // ê·¸ë¦¬í¼ ë‹«ê¸°
        document.getElementById('btn-gripper-close').addEventListener('click', () => {
            socket.emit('gripper_command', { command: 'close' });
        });
        
        // ì‚¬ìš©ì í™ˆìœ¼ë¡œ ì´ë™ (0,0,90,0,90,0) - ê·¸ë¦¬í¼ ì•„ë˜ ë°©í–¥
        document.getElementById('btn-move-user-home').addEventListener('click', () => {
            if (confirm('ë¡œë´‡ì„ ì‚¬ìš©ì í™ˆ ìœ„ì¹˜ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nğŸ“ ì¡°ì¸íŠ¸: [0, 0, 90, 0, 90, 0]\nğŸ‘‡ ê·¸ë¦¬í¼ê°€ ì•„ë˜ë¥¼ ë°”ë¼ë³´ëŠ” ìì„¸\n\nâš ï¸ ì£¼ë³€ì— ì¥ì• ë¬¼ì´ ì—†ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”!')) {
                socket.emit('move_home', { target: 1 });
            }
        });
        
        // ê¸°ê³„ì  í™ˆìœ¼ë¡œ ì´ë™ (0,0,0,0,0,0) - ë¡œë´‡ ì¼ì–´ì„  ìì„¸
        document.getElementById('btn-move-mech-home').addEventListener('click', () => {
            if (confirm('ë¡œë´‡ì„ ê¸°ê³„ì  í™ˆ ìœ„ì¹˜ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nğŸ“ ì¡°ì¸íŠ¸: [0, 0, 0, 0, 0, 0]\nâ¬†ï¸ ë¡œë´‡ì´ ìœ„ë¡œ ì¼ì–´ì„  ìì„¸\n\nâš ï¸ ì£¼ë³€ì— ì¥ì• ë¬¼ì´ ì—†ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”!')) {
                socket.emit('move_home', { target: 0 });
            }
        });
        
        // ë¹„ìƒì •ì§€ (ëª¨ë“  ë™ì‘ ì¦‰ì‹œ ì¤‘ë‹¨)
        let isStopped = false;
        document.getElementById('btn-estop').addEventListener('click', () => {
            socket.emit('emergency_stop');
            isStopped = true;
            document.getElementById('btn-estop').disabled = true;
            document.getElementById('btn-resume').disabled = false;
            document.getElementById('btn-estop').style.opacity = '0.5';
            document.getElementById('btn-resume').style.opacity = '1';
            
            // ì§„ììš´ë™ UI ë¦¬ì…‹
            document.getElementById('btn-pendulum-start').disabled = false;
            document.getElementById('btn-pendulum-stop').disabled = true;
            document.getElementById('pendulum-joint').disabled = false;
            document.getElementById('pendulum-amplitude').disabled = false;
            document.getElementById('pendulum-velocity').disabled = false;
            document.getElementById('pendulum-status').innerHTML = 'â¹ï¸ ë¹„ìƒì •ì§€ë¡œ ì¤‘ë‹¨ë¨';
        });
        
        // ì¬ê°œ
        document.getElementById('btn-resume').addEventListener('click', () => {
            socket.emit('move_resume');
            isStopped = false;
            document.getElementById('btn-estop').disabled = false;
            document.getElementById('btn-resume').disabled = true;
            document.getElementById('btn-estop').style.opacity = '1';
            document.getElementById('btn-resume').style.opacity = '0.5';
        });
        
        // ì •ì§€ ìƒíƒœ ìˆ˜ì‹ 
        socket.on('stop_status', (data) => {
            isStopped = data.stopped;
            document.getElementById('btn-estop').disabled = isStopped;
            document.getElementById('btn-resume').disabled = !isStopped;
            document.getElementById('btn-estop').style.opacity = isStopped ? '0.5' : '1';
            document.getElementById('btn-resume').style.opacity = isStopped ? '1' : '0.5';
        });
        
        // ============== ì§„ììš´ë™ í…ŒìŠ¤íŠ¸ ==============
        document.getElementById('btn-pendulum-start').addEventListener('click', () => {
            const jointIndex = parseInt(document.getElementById('pendulum-joint').value);
            let amplitude = parseFloat(document.getElementById('pendulum-amplitude').value);
            let velocity = parseFloat(document.getElementById('pendulum-velocity').value);
            
            // ë²”ìœ„ ì²´í¬
            if (amplitude < 5) amplitude = 5;
            if (amplitude > 45) amplitude = 45;
            if (velocity < 5) velocity = 5;
            if (velocity > 100) velocity = 100;
            document.getElementById('pendulum-amplitude').value = amplitude;
            document.getElementById('pendulum-velocity').value = velocity;
            
            const jointNames = ['J1 (ë² ì´ìŠ¤)', 'J2 (ìˆ„ë”)', 'J3 (ì—˜ë³´)', 'J4 (ì†ëª©1)', 'J5 (ì†ëª©2)', 'J6 (ì†ëª©3)'];
            
            if (confirm(`ì§„ììš´ë™ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nğŸ”§ ì¡°ì¸íŠ¸: ${jointNames[jointIndex]}\nğŸ“ ì§„í­: Â±${amplitude}Â°\nâš¡ ì†ë„: ${velocity}Â°/s\n\nâš ï¸ ì£¼ë³€ì— ì¥ì• ë¬¼ì´ ì—†ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”!`)) {
                // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
                document.getElementById('btn-pendulum-start').disabled = true;
                document.getElementById('btn-pendulum-stop').disabled = false;
                document.getElementById('pendulum-joint').disabled = true;
                document.getElementById('pendulum-amplitude').disabled = true;
                document.getElementById('pendulum-velocity').disabled = true;
                
                // ì„œë²„ë¡œ ëª…ë ¹ ì „ì†¡
                socket.emit('pendulum_start', {
                    joint: jointIndex,
                    amplitude: amplitude,
                    velocity: velocity
                });
                
                document.getElementById('pendulum-status').innerHTML = 
                    `â–¶ï¸ <span style="color: #00b894;">ì§„ììš´ë™ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘</span><br>` +
                    `<span style="font-size: 0.9em; color: #888;">` +
                    `${jointNames[jointIndex]} | Â±${amplitude}Â° | ${velocity}Â°/s</span>`;
            }
        });
        
        document.getElementById('btn-pendulum-stop').addEventListener('click', () => {
            socket.emit('pendulum_stop');
            
            // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
            document.getElementById('btn-pendulum-start').disabled = false;
            document.getElementById('btn-pendulum-stop').disabled = true;
            document.getElementById('pendulum-joint').disabled = false;
            document.getElementById('pendulum-amplitude').disabled = false;
            document.getElementById('pendulum-velocity').disabled = false;
            
            document.getElementById('pendulum-status').innerHTML = 
                `â¸ï¸ ì§„ììš´ë™ í…ŒìŠ¤íŠ¸ ë¹„í™œì„±í™”`;
        });
        
        // ì„œë²„ì—ì„œ ì§„ììš´ë™ ìƒíƒœ ìˆ˜ì‹ 
        socket.on('pendulum_status', (data) => {
            if (data.running) {
                document.getElementById('btn-pendulum-start').disabled = true;
                document.getElementById('btn-pendulum-stop').disabled = false;
                document.getElementById('pendulum-joint').disabled = true;
                document.getElementById('pendulum-amplitude').disabled = true;
                document.getElementById('pendulum-velocity').disabled = true;
                const jointNames = ['J1 (ë² ì´ìŠ¤)', 'J2 (ìˆ„ë”)', 'J3 (ì—˜ë³´)', 'J4 (ì†ëª©1)', 'J5 (ì†ëª©2)', 'J6 (ì†ëª©3)'];
                document.getElementById('pendulum-status').innerHTML = 
                    `â–¶ï¸ <span style="color: #00b894;">ì§„ììš´ë™ ì‹¤í–‰ ì¤‘</span><br>` +
                    `<span style="font-size: 0.9em; color: #888;">${jointNames[data.joint] || 'J?'} | Â±${data.amplitude || 15}Â° | ${data.velocity || 30}Â°/s</span>`;
            } else {
                document.getElementById('btn-pendulum-start').disabled = false;
                document.getElementById('btn-pendulum-stop').disabled = true;
                document.getElementById('pendulum-joint').disabled = false;
                document.getElementById('pendulum-amplitude').disabled = false;
                document.getElementById('pendulum-velocity').disabled = false;
                document.getElementById('pendulum-status').innerHTML = `â¸ï¸ ì§„ììš´ë™ í…ŒìŠ¤íŠ¸ ë¹„í™œì„±í™”`;
            }
        });
        
        // UI ìƒíƒœ ë™ê¸°í™” (ë¡œì»¬/ì™¸ë¶€ ì›¹ ê°„)
        socket.on('ui_state', (state) => {
            // ì§„ììš´ë™ ìƒíƒœ
            if (state.pendulum_running) {
                document.getElementById('btn-pendulum-start').disabled = true;
                document.getElementById('btn-pendulum-stop').disabled = false;
                document.getElementById('pendulum-joint').disabled = true;
                document.getElementById('pendulum-amplitude').disabled = true;
                document.getElementById('pendulum-velocity').disabled = true;
                document.getElementById('pendulum-status').innerHTML = 
                    `â–¶ï¸ <span style="color: #00b894;">ì§„ììš´ë™ ì‹¤í–‰ ì¤‘</span>`;
            } else if (state.paused_task === 'pendulum') {
                // ì§„ììš´ë™ì´ ì¼ì‹œì •ì§€ëœ ìƒíƒœ
                document.getElementById('btn-pendulum-start').disabled = true;
                document.getElementById('btn-pendulum-stop').disabled = true;
                document.getElementById('pendulum-joint').disabled = true;
                document.getElementById('pendulum-amplitude').disabled = true;
                document.getElementById('pendulum-velocity').disabled = true;
                document.getElementById('pendulum-status').innerHTML = 
                    `â¸ï¸ <span style="color: #ffc107;">ì¼ì‹œì •ì§€ (ì¬ê°œ ë²„íŠ¼ìœ¼ë¡œ ì´ì–´ì„œ ì‹¤í–‰)</span>`;
            } else {
                document.getElementById('btn-pendulum-start').disabled = false;
                document.getElementById('btn-pendulum-stop').disabled = true;
                document.getElementById('pendulum-joint').disabled = false;
                document.getElementById('pendulum-amplitude').disabled = false;
                document.getElementById('pendulum-velocity').disabled = false;
                if (!state.is_stopped) {
                    document.getElementById('pendulum-status').innerHTML = `â¸ï¸ ì§„ììš´ë™ í…ŒìŠ¤íŠ¸ ë¹„í™œì„±í™”`;
                }
            }
            
            // ë¹„ìƒì •ì§€ ìƒíƒœ
            const taskNames = {
                'pendulum': 'ì§„ììš´ë™',
                'move_home_user': 'ì‚¬ìš©ì í™ˆ',
                'move_home_mech': 'ê¸°ê³„ì  í™ˆ'
            };
            
            if (state.is_stopped) {
                document.getElementById('btn-estop').disabled = true;
                document.getElementById('btn-resume').disabled = false;
                document.getElementById('btn-estop').style.opacity = '0.5';
                document.getElementById('btn-resume').style.opacity = '1';
                
                // ì¼ì‹œì •ì§€ëœ ì‘ì—…ì´ ìˆìœ¼ë©´ í‘œì‹œ
                if (state.paused_task && taskNames[state.paused_task]) {
                    document.getElementById('btn-resume').innerHTML = `â–¶ï¸ ì¬ê°œ (${taskNames[state.paused_task]})`;
                } else {
                    document.getElementById('btn-resume').innerHTML = 'â–¶ï¸ ì¬ê°œ';
                }
            } else {
                document.getElementById('btn-estop').disabled = false;
                document.getElementById('btn-resume').disabled = true;
                document.getElementById('btn-estop').style.opacity = '1';
                document.getElementById('btn-resume').style.opacity = '0.5';
                document.getElementById('btn-resume').innerHTML = 'â–¶ï¸ ì¬ê°œ';
            }
        });
        
        // ì—°ê²° ì‹œ UI ìƒíƒœ ìš”ì²­
        socket.on('connect', () => {
            socket.emit('get_ui_state');
        });
        
        // ì†ë„ ìŠ¬ë¼ì´ë” (debounce ì ìš©ìœ¼ë¡œ ì‹¤ì‹œê°„ ë°˜ì‘)
        const speedSlider = document.getElementById('speed-slider');
        let speedDebounceTimer = null;
        window.isSpeedSliderDragging = false;
        
        speedSlider.addEventListener('mousedown', () => { window.isSpeedSliderDragging = true; });
        speedSlider.addEventListener('touchstart', () => { window.isSpeedSliderDragging = true; });
        speedSlider.addEventListener('mouseup', () => { window.isSpeedSliderDragging = false; });
        speedSlider.addEventListener('touchend', () => { window.isSpeedSliderDragging = false; });
        
        speedSlider.addEventListener('input', (e) => {
            document.getElementById('speed-display').textContent = e.target.value;
            
            // 50ms debounceë¡œ ì‹¤ì‹œê°„ ì „ì†¡
            if (speedDebounceTimer) clearTimeout(speedDebounceTimer);
            speedDebounceTimer = setTimeout(() => {
                socket.emit('speed_change', { speed: parseInt(e.target.value) });
            }, 50);
        });
        speedSlider.addEventListener('change', (e) => {
            // ë“œë˜ê·¸ ëë‚  ë•Œ ìµœì¢… ê°’ ì „ì†¡ (ë³´ì¥ìš©)
            if (speedDebounceTimer) clearTimeout(speedDebounceTimer);
            socket.emit('speed_change', { speed: parseInt(e.target.value) });
        });
        
        // ì†ë„ 100% ë¦¬ì…‹ ë²„íŠ¼
        document.getElementById('btn-speed-reset').addEventListener('click', () => {
            socket.emit('speed_change', { speed: 100 });
            document.getElementById('speed-slider').value = 100;
            document.getElementById('speed-display').textContent = '100';
        });
        
        // ============== 3D ë¡œë´‡ ë·°ì–´ ==============
        let scene, camera, renderer, controls;
        let robotJoints = [];
        let autoRotate = false;
        
        function init3DViewer() {
            const container = document.getElementById('robot-viewer-container');
            const canvas = document.getElementById('robot-canvas');
            
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);
            
            // Camera
            camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(500, 400, 500);
            
            // Renderer
            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.shadowMap.enabled = true;
            
            // Controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.target.set(0, 200, 0);
            
            // Lights
            const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(200, 500, 300);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            const pointLight = new THREE.PointLight(0x00d4ff, 0.5, 1000);
            pointLight.position.set(0, 300, 0);
            scene.add(pointLight);
            
            // Grid
            const gridHelper = new THREE.GridHelper(600, 20, 0x00d4ff, 0x333355);
            scene.add(gridHelper);
            
            // Axes
            const axesHelper = new THREE.AxesHelper(100);
            scene.add(axesHelper);
            
            // Create robot arm (simplified)
            createRobotArm();
            
            // Resize handler
            window.addEventListener('resize', onWindowResize);
            
            // Animation loop
            animate3D();
            
            // Update joint angles display
            updateJointAnglesDisplay();
        }
        
        function createRobotArm() {
            // Link lengths (approximate for M0609)
            const linkLengths = [155, 0, 309, 0, 309, 0]; // mm
            const colors = [0x00d4ff, 0xff6384, 0x36a2eb, 0xffce56, 0x4bc0c0, 0x9966ff];
            
            // Base
            const baseGeom = new THREE.CylinderGeometry(70, 80, 50, 32);
            const baseMat = new THREE.MeshPhongMaterial({ color: 0x444466 });
            const base = new THREE.Mesh(baseGeom, baseMat);
            base.position.y = 25;
            scene.add(base);
            
            let prevJoint = base;
            let yOffset = 50;
            
            // Create joints and links
            for (let i = 0; i < 6; i++) {
                // Joint (sphere)
                const jointGeom = new THREE.SphereGeometry(25, 16, 16);
                const jointMat = new THREE.MeshPhongMaterial({ color: colors[i], emissive: colors[i], emissiveIntensity: 0.2 });
                const joint = new THREE.Mesh(jointGeom, jointMat);
                
                if (i === 0) {
                    joint.position.y = yOffset + linkLengths[0];
                } else if (i === 2) {
                    joint.position.y = linkLengths[2];
                } else if (i === 4) {
                    joint.position.y = linkLengths[4];
                } else {
                    joint.position.y = 40;
                }
                
                // Create group for rotation
                const jointGroup = new THREE.Group();
                jointGroup.add(joint);
                
                // Link (cylinder)
                if (i < 5) {
                    const linkLength = (i === 1 || i === 3) ? 40 : (i === 0 ? linkLengths[0] : linkLengths[i+1] > 0 ? linkLengths[i+1] : 60);
                    const linkGeom = new THREE.CylinderGeometry(15, 18, linkLength, 16);
                    const linkMat = new THREE.MeshPhongMaterial({ color: 0x555577 });
                    const link = new THREE.Mesh(linkGeom, linkMat);
                    link.position.y = linkLength / 2 + 25;
                    joint.add(link);
                }
                
                // End effector
                if (i === 5) {
                    const eeGeom = new THREE.BoxGeometry(60, 80, 30);
                    const eeMat = new THREE.MeshPhongMaterial({ color: 0x00b894 });
                    const ee = new THREE.Mesh(eeGeom, eeMat);
                    ee.position.y = 60;
                    joint.add(ee);
                }
                
                if (i === 0) {
                    scene.add(jointGroup);
                } else {
                    robotJoints[i-1].children[0].add(jointGroup);
                }
                
                robotJoints.push(jointGroup);
            }
        }
        
        function updateRobotPose(jointAngles) {
            if (!robotJoints.length) return;
            
            // Rotation axes for each joint (simplified)
            const axes = ['y', 'z', 'z', 'y', 'z', 'y'];
            
            for (let i = 0; i < Math.min(jointAngles.length, robotJoints.length); i++) {
                const angle = jointAngles[i] * Math.PI / 180; // Convert to radians
                if (axes[i] === 'y') {
                    robotJoints[i].rotation.y = angle;
                } else if (axes[i] === 'z') {
                    robotJoints[i].rotation.z = angle;
                }
            }
        }
        
        function updateJointAnglesDisplay() {
            const container = document.getElementById('joint-angles-3d');
            container.innerHTML = '';
            for (let i = 0; i < 6; i++) {
                const div = document.createElement('div');
                div.className = 'tcp-item';
                div.innerHTML = `<div class="tcp-label">J${i+1}</div><div class="tcp-value" id="j3d-${i}" style="color: ${jointColors[i]}">0Â°</div>`;
                container.appendChild(div);
            }
        }
        
        function onWindowResize() {
            const container = document.getElementById('robot-viewer-container');
            if (!container) return;
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }
        
        function animate3D() {
            requestAnimationFrame(animate3D);
            if (autoRotate) {
                camera.position.x = 500 * Math.cos(Date.now() * 0.0005);
                camera.position.z = 500 * Math.sin(Date.now() * 0.0005);
                camera.lookAt(0, 200, 0);
            }
            controls.update();
            renderer.render(scene, camera);
        }
        
        function resetCameraView() {
            camera.position.set(500, 400, 500);
            controls.target.set(0, 200, 0);
            controls.update();
        }
        
        function toggleAutoRotate() {
            autoRotate = !autoRotate;
        }
        
        // Initialize 3D viewer when page loads
        window.addEventListener('load', () => {
            setTimeout(init3DViewer, 100);
        });
        
        // Update 3D viewer when joint data changes
        socket.on('robot_state', (data) => {
            // Update 3D model pose
            if (data.actual_joint_position) {
                updateRobotPose(data.actual_joint_position);
                
                // Update display values
                for (let i = 0; i < 6; i++) {
                    const el = document.getElementById(`j3d-${i}`);
                    if (el) el.textContent = data.actual_joint_position[i].toFixed(1) + 'Â°';
                }
            }
            
            // Update TCP display
            if (data.actual_tcp_position) {
                const labels = ['x', 'y', 'z', 'rx', 'ry', 'rz'];
                labels.forEach((l, i) => {
                    const el = document.getElementById(`tcp3d-${l}`);
                    if (el) el.textContent = data.actual_tcp_position[i]?.toFixed(1) || '0';
                });
            }
            
            // Update gripper status based on DO1/DO2
            const dout = data.controller_digital_output || 0;
            const do1 = (dout & 1) !== 0;  // DO1 ON = bit 0
            const do2 = (dout & 2) !== 0;  // DO2 ON = bit 1
            const gripperEl = document.getElementById('gripper3d');
            if (gripperEl) {
                if (do1 && !do2) {
                    gripperEl.textContent = 'ì—´ë¦¼';
                    gripperEl.style.color = '#00b894';
                } else if (!do1 && do2) {
                    gripperEl.textContent = 'ë‹«í˜';
                    gripperEl.style.color = '#d63031';
                } else {
                    gripperEl.textContent = 'ëŒ€ê¸°';
                    gripperEl.style.color = '#888';
                }
            }
        });
        
        // RViz ìŠ¤íŠ¸ë¦¼ í•¨ìˆ˜
        function reloadRvizStream() {
            const img = document.getElementById('rviz-stream');
            const error = document.getElementById('rviz-error');
            img.style.display = 'block';
            error.style.display = 'none';
            img.src = '/rviz_stream?' + new Date().getTime();
        }
        
        function openRvizFullscreen() {
            window.open('/rviz_stream', '_blank', 'width=1200,height=800');
        }
        
        // ============== Tool/TCP ê´€ë ¨ ==============
        let toolTcpWarningShown = false;  // ê²½ê³  ì¤‘ë³µ ë°©ì§€
        let lastToolName = null;
        let lastTcpName = null;
        
        function updateToolTcpInfo(data) {
            const toolName = data.current_tool_name || '';
            const tcpName = data.current_tcp_name || '';
            const flangePos = data.tool_flange_posx || [0,0,0,0,0,0];
            
            // Tool ì´ë¦„ í‘œì‹œ
            const toolNameEl = document.getElementById('current-tool-name');
            const toolDisplayEl = document.getElementById('tool-name-display');
            const toolIndicator = document.getElementById('tool-status-indicator');
            
            if (toolName === '' || toolName === null) {
                toolNameEl.textContent = 'âš ï¸ ë¯¸ì„¤ì •';
                toolDisplayEl.classList.add('not-set');
                toolIndicator.className = 'tool-status-indicator tool-status-error';
                document.getElementById('tool-info-status').textContent = 'ë¯¸ì„¤ì •';
                document.getElementById('tool-info-status').className = 'status-value error';
                document.getElementById('tool-check-status').textContent = 'âŒ ë¯¸ì„¤ì •';
                document.getElementById('tool-check-status').className = 'status-value error';
            } else {
                toolNameEl.textContent = toolName;
                toolDisplayEl.classList.remove('not-set');
                toolIndicator.className = 'tool-status-indicator tool-status-ok';
                document.getElementById('tool-info-status').textContent = 'ì„¤ì •ë¨';
                document.getElementById('tool-info-status').className = 'status-value active';
                document.getElementById('tool-check-status').textContent = 'âœ… ' + toolName;
                document.getElementById('tool-check-status').className = 'status-value active';
            }
            
            // TCP ì´ë¦„ í‘œì‹œ
            const tcpNameEl = document.getElementById('current-tcp-name');
            const tcpDisplayEl = document.getElementById('tcp-name-display');
            const tcpIndicator = document.getElementById('tcp-status-indicator');
            
            if (tcpName === '' || tcpName === null) {
                tcpNameEl.textContent = 'âš ï¸ ë¯¸ì„¤ì •';
                tcpDisplayEl.classList.add('not-set');
                tcpIndicator.className = 'tool-status-indicator tool-status-error';
                document.getElementById('tcp-info-status').textContent = 'ë¯¸ì„¤ì •';
                document.getElementById('tcp-info-status').className = 'status-value error';
                document.getElementById('tcp-check-status').textContent = 'âŒ ë¯¸ì„¤ì •';
                document.getElementById('tcp-check-status').className = 'status-value error';
            } else {
                tcpNameEl.textContent = tcpName;
                tcpDisplayEl.classList.remove('not-set');
                tcpIndicator.className = 'tool-status-indicator tool-status-ok';
                document.getElementById('tcp-info-status').textContent = 'ì„¤ì •ë¨';
                document.getElementById('tcp-info-status').className = 'status-value active';
                document.getElementById('tcp-check-status').textContent = 'âœ… ' + tcpName;
                document.getElementById('tcp-check-status').className = 'status-value active';
            }
            
            // ì¸ë±ìŠ¤ í‘œì‹œ
            document.getElementById('tool-info-index').textContent = data.tool_index ?? '--';
            document.getElementById('tcp-info-index').textContent = data.tcp_index ?? '--';
            
            // Flange Position í‘œì‹œ
            const flangeLabels = ['x', 'y', 'z', 'rx', 'ry', 'rz'];
            flangeLabels.forEach((l, i) => {
                const el = document.getElementById(`flange-${l}`);
                if (el) el.textContent = flangePos[i]?.toFixed(2) || '0.00';
            });
            
            // ë§ˆì§€ë§‰ í™•ì¸ ì‹œê°„
            const now = new Date();
            document.getElementById('tool-check-time').textContent = 
                now.getHours().toString().padStart(2, '0') + ':' + 
                now.getMinutes().toString().padStart(2, '0') + ':' + 
                now.getSeconds().toString().padStart(2, '0');
            
            // ê²½ê³  íŒì—… ì²´í¬ (ì²˜ìŒ ì—°ê²°ë˜ê±°ë‚˜ ì„¤ì •ì´ ë°”ë€Œì—ˆì„ ë•Œë§Œ)
            const toolChanged = lastToolName !== null && lastToolName !== toolName;
            const tcpChanged = lastTcpName !== null && lastTcpName !== tcpName;
            
            if ((toolName === '' || tcpName === '') && !toolTcpWarningShown) {
                // ì—°ê²° í›„ 3ì´ˆ ëŒ€ê¸° í›„ íŒì—… í‘œì‹œ
                setTimeout(() => {
                    if ((data.current_tool_name === '' || data.current_tcp_name === '') && !toolTcpWarningShown) {
                        showToolTcpWarning(data.current_tool_name || '', data.current_tcp_name || '');
                        toolTcpWarningShown = true;
                    }
                }, 3000);
            }
            
            lastToolName = toolName;
            lastTcpName = tcpName;
        }
        
        function showToolTcpWarning(toolName, tcpName) {
            const modal = document.getElementById('warning-modal');
            const warningTool = document.getElementById('warning-tool');
            const warningTcp = document.getElementById('warning-tcp');
            
            // Tool ìƒíƒœ
            if (toolName === '') {
                warningTool.textContent = 'âŒ ë¯¸ì„¤ì •';
                warningTool.className = 'warning-details-value error';
            } else {
                warningTool.textContent = 'âœ… ' + toolName;
                warningTool.className = 'warning-details-value ok';
            }
            
            // TCP ìƒíƒœ
            if (tcpName === '') {
                warningTcp.textContent = 'âŒ ë¯¸ì„¤ì •';
                warningTcp.className = 'warning-details-value error';
            } else {
                warningTcp.textContent = 'âœ… ' + tcpName;
                warningTcp.className = 'warning-details-value ok';
            }
            
            // ë©”ì‹œì§€ ì„¤ì •
            let message = '';
            if (toolName === '' && tcpName === '') {
                message = 'Toolê³¼ TCP ëª¨ë‘ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>ë¡œë´‡ ì‘ì—… ì „ ë°˜ë“œì‹œ ì„¤ì •í•´ì£¼ì„¸ìš”.';
            } else if (toolName === '') {
                message = 'Toolì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>ì •í™•í•œ ë™ì—­í•™ ê³„ì‚°ì„ ìœ„í•´ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.';
            } else if (tcpName === '') {
                message = 'TCPê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>ì •í™•í•œ ì‘ì—…ì  ê³„ì‚°ì„ ìœ„í•´ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.';
            }
            document.getElementById('warning-message').innerHTML = message;
            
            modal.classList.add('show');
        }
        
        function closeWarningModal() {
            document.getElementById('warning-modal').classList.remove('show');
        }
        
        // ============== ë¦¬ì»¤ë²„ë¦¬ ëª¨ë‹¬ ê´€ë ¨ ==============
        let recoveryStartTime = null;
        let recoveryTimerInterval = null;
        
        function showRecoveryModal() {
            const modal = document.getElementById('recovery-modal');
            const content = document.getElementById('recovery-content');
            
            // ì´ˆê¸° ìƒíƒœë¡œ ë¦¬ì…‹
            content.classList.remove('completed');
            document.getElementById('recovery-icon').textContent = 'âš ï¸';
            document.getElementById('recovery-title').textContent = 'ì¶©ëŒ ê°ì§€ - ë³µêµ¬ ëª¨ë“œ';
            document.getElementById('recovery-message').textContent = 'ìë™ ë³µêµ¬ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤';
            document.getElementById('recovery-progress-fill').style.width = '0%';
            document.getElementById('recovery-progress-fill').textContent = '0%';
            document.getElementById('recovery-step-text').textContent = 'ì¤€ë¹„ ì¤‘...';
            document.getElementById('recovery-step-icon').textContent = 'âš™ï¸';
            
            // íƒ€ì´ë¨¸ ì‹œì‘
            recoveryStartTime = Date.now();
            if (recoveryTimerInterval) clearInterval(recoveryTimerInterval);
            recoveryTimerInterval = setInterval(updateRecoveryTime, 100);
            
            modal.classList.add('show');
        }
        
        function updateRecoveryProgress(progress, step) {
            const progressFill = document.getElementById('recovery-progress-fill');
            progressFill.style.width = progress + '%';
            progressFill.textContent = progress + '%';
            
            if (step) {
                document.getElementById('recovery-step-text').textContent = step;
            }
        }
        
        function updateRecoveryTime() {
            if (!recoveryStartTime) return;
            const elapsed = Math.floor((Date.now() - recoveryStartTime) / 1000);
            document.getElementById('recovery-time').textContent = 'â±ï¸ ê²½ê³¼ ì‹œê°„: ' + elapsed + 'ì´ˆ';
        }
        
        function completeRecoveryModal() {
            const content = document.getElementById('recovery-content');
            content.classList.add('completed');
            
            document.getElementById('recovery-icon').textContent = 'âœ…';
            document.getElementById('recovery-title').textContent = 'ë³µêµ¬ ì™„ë£Œ';
            document.getElementById('recovery-message').textContent = 'ì •ìƒì ìœ¼ë¡œ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤';
            document.getElementById('recovery-progress-fill').style.width = '100%';
            document.getElementById('recovery-progress-fill').textContent = '100%';
            document.getElementById('recovery-step-text').textContent = 'ë³µêµ¬ ì™„ë£Œ!';
            document.getElementById('recovery-step-icon').textContent = 'âœ“';
            
            // íƒ€ì´ë¨¸ ì •ì§€
            if (recoveryTimerInterval) {
                clearInterval(recoveryTimerInterval);
                recoveryTimerInterval = null;
            }
            
            // 3ì´ˆ í›„ ìë™ìœ¼ë¡œ ëª¨ë‹¬ ë‹«ê¸°
            setTimeout(() => {
                closeRecoveryModal();
            }, 3000);
        }
        
        function closeRecoveryModal() {
            document.getElementById('recovery-modal').classList.remove('show');
            recoveryStartTime = null;
            if (recoveryTimerInterval) {
                clearInterval(recoveryTimerInterval);
                recoveryTimerInterval = null;
            }
        }
        
        // ë¦¬ì»¤ë²„ë¦¬ ìƒíƒœ ì†Œì¼“ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        socket.on('recovery_status', (data) => {
            console.log('[Recovery]', data);
            
            if (data.status === 'started' || data.status === 'recovering') {
                showRecoveryModal();
                if (data.progress !== undefined) {
                    updateRecoveryProgress(data.progress, data.step || 'ë³µêµ¬ ì§„í–‰ ì¤‘...');
                }
            } else if (data.status === 'progress') {
                updateRecoveryProgress(data.progress || 0, data.step || 'ë³µêµ¬ ì§„í–‰ ì¤‘...');
            } else if (data.status === 'completed') {
                updateRecoveryProgress(100, 'ì™„ë£Œ!');
                completeRecoveryModal();
            } else if (data.status === 'failed') {
                document.getElementById('recovery-title').textContent = 'ë³µêµ¬ ì‹¤íŒ¨';
                document.getElementById('recovery-message').textContent = data.message || 'ë³µêµ¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤';
                document.getElementById('recovery-icon').textContent = 'âŒ';
                setTimeout(() => closeRecoveryModal(), 5000);
            }
        });

        function checkToolTcpStatus() {
            const toolName = lastToolName || '';
            const tcpName = lastTcpName || '';
            
            if (toolName === '' || tcpName === '') {
                showToolTcpWarning(toolName, tcpName);
            } else {
                alert('âœ… Tool/TCP ì„¤ì • ì •ìƒ\\n\\nTool: ' + toolName + '\\nTCP: ' + tcpName);
            }
        }
        
        // robot_state ìˆ˜ì‹  ì‹œ Tool/TCP ì •ë³´ë„ ì—…ë°ì´íŠ¸
        socket.on('robot_state', (data) => {
            updateToolTcpInfo(data);
        });
        
        // ===== ë¶„ë¥˜ ì œì–´ ê¸°ëŠ¥ (ê°„ì†Œí™”) =====
        let sortRunning = false;  // ë¶„ë¥˜ ì‘ì—… ì‹¤í–‰ ìƒíƒœ
        
        // ë¶„ë¥˜ ì‹œì‘/ë¹„ìƒì •ì§€ í† ê¸€ ë²„íŠ¼
        document.getElementById('btn-sort-start')?.addEventListener('click', () => {
            const btn = document.getElementById('btn-sort-start');
            
            if (!sortRunning) {
                // ë¶„ë¥˜ ì‹œì‘
                socket.emit('sort_start');
                btn.innerHTML = 'ğŸ›‘ ë¹„ìƒì •ì§€';
                btn.className = 'btn';
                btn.style.background = 'linear-gradient(135deg, #c0392b, #e74c3c)';
                btn.style.color = 'white';
                sortRunning = true;
                document.getElementById('sort-message').innerHTML = 'ğŸš€ ë¶„ë¥˜ ì‘ì—… ì‹œì‘...';
                addSortLog('ğŸš€ ë¶„ë¥˜ ì‹œì‘');
            } else {
                // ë¹„ìƒì •ì§€
                socket.emit('emergency_stop');
                socket.emit('sort_pause', { pause: true });
                btn.innerHTML = 'â–¶ï¸ ë¶„ë¥˜ ì‹œì‘';
                btn.className = 'btn btn-success';
                btn.style.background = '';
                btn.style.color = '';
                sortRunning = false;
                document.getElementById('sort-message').innerHTML = '<span style="color: #e74c3c;">ğŸ›‘ ë¹„ìƒì •ì§€! ë¶„ë¥˜ ì‹œì‘ì„ ëˆŒëŸ¬ ì¬ê°œí•˜ì„¸ìš”</span>';
                addSortLog('ğŸ›‘ ë¹„ìƒì •ì§€ ì‹¤í–‰!');
            }
        });
        
        // í™ˆìœ¼ë¡œ ì´ë™ ë²„íŠ¼
        document.getElementById('btn-sort-home')?.addEventListener('click', () => {
            const startBtn = document.getElementById('btn-sort-start');
            
            socket.emit('sort_stop');
            socket.emit('move_home', { target: 1 });
            
            startBtn.innerHTML = 'â–¶ï¸ ë¶„ë¥˜ ì‹œì‘';
            startBtn.className = 'btn btn-success';
            startBtn.style.background = '';
            startBtn.style.color = '';
            sortRunning = false;
            document.getElementById('sort-message').innerHTML = 'ğŸ  í™ˆ ìœ„ì¹˜ë¡œ ì´ë™ ì¤‘...';
            addSortLog('ğŸ  í™ˆìœ¼ë¡œ ì´ë™');
        });
        
        // ì›í…Œì´í¬ ì‹œë‚˜ë¦¬ì˜¤ ë²„íŠ¼
        document.getElementById('btn-one-take')?.addEventListener('click', () => {
            if (confirm('ğŸ¬ ì›í…Œì´í¬ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n[1ë‹¨ê³„] 1ì°¨ ë¶„ë¥˜ (ì»¨ë² ì´ì–´ â†’ ë¶„ë¥˜êµ¬ì—­)\n  â€¢ ì»¨ë² ì´ì–´ ìë™ ì‹œì‘\n  â€¢ ë¸”ë¡ ê°ì§€ â†’ í¬ê¸° ë¶„ë¥˜\n  â€¢ SMALL 2ê°œ + MEDIUM 2ê°œ + LARGE 2ê°œ (ì´ 6ê°œ)\n\n[2ë‹¨ê³„] 2ì°¨ ì ì¬ (ë¶„ë¥˜êµ¬ì—­ â†’ ì ì¬êµ¬ì—­)\n  â€¢ í…ŒíŠ¸ë¦¬ìŠ¤ ì•Œê³ ë¦¬ì¦˜ ì ìš©\n  â€¢ MEDIUMâ†’LARGEâ†’LARGEâ†’MEDIUMâ†’SMALLâ†’SMALL\n  â€¢ ì´ 6ê°œ ì¬ë°°ì¹˜')) {
                socket.emit('one_take_start');
                document.getElementById('sort-message').innerHTML = 'ğŸ¬ ì›í…Œì´í¬ ì‹œë‚˜ë¦¬ì˜¤ ì‹œì‘...';
                addSortLog('ğŸ¬ ì›í…Œì´í¬ ì‹œë‚˜ë¦¬ì˜¤ ì‹œì‘');
            }
        });
        
        // â˜… ë³µêµ¬ í…ŒìŠ¤íŠ¸ ë²„íŠ¼ (í´ë¼ì´ì–¸íŠ¸ UI í…ŒìŠ¤íŠ¸)
        document.getElementById('btn-test-recovery')?.addEventListener('click', () => {
            console.log('[Test] Client-side recovery simulation...');
            showRecoveryModal();
            
            // ì‹œë®¬ë ˆì´ì…˜: ë‹¨ê³„ë³„ ì§„í–‰
            const steps = [
                { p: 10, s: 'ë³µêµ¬ ëª¨ë“œ ì§„ì…...' },
                { p: 25, s: 'ì„œë³´ OFF' },
                { p: 50, s: 'Zì¶• ìƒìŠ¹ ì¤‘...' },
                { p: 70, s: 'í™ˆ ìœ„ì¹˜ë¡œ ì´ë™...' },
                { p: 90, s: 'ì„œë³´ ON' },
                { p: 100, s: 'ë³µêµ¬ ì™„ë£Œ!' }
            ];
            
            let i = 0;
            const interval = setInterval(() => {
                if (i < steps.length) {
                    updateRecoveryProgress(steps[i].p, steps[i].s);
                    i++;
                } else {
                    clearInterval(interval);
                    completeRecoveryModal();
                }
            }, 800);
        });
        
        // â˜… ë³µêµ¬ í…ŒìŠ¤íŠ¸ ë²„íŠ¼ (ì„œë²„ ì´ë²¤íŠ¸ í…ŒìŠ¤íŠ¸) - Shift í´ë¦­
        document.getElementById('btn-test-recovery')?.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            console.log('[Test] Server-side recovery simulation via socket...');
            socket.emit('test_recovery_popup');
        });
        
        // â˜… ì „ì²´ ì´ˆê¸°í™” ë²„íŠ¼ (ë°ì´í„° íƒ­)
        document.getElementById('btn-reset-all')?.addEventListener('click', () => {
            if (confirm('ğŸ—‘ï¸ ì „ì²´ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâ€¢ ë¶„ë¥˜ ì‚¬ì´í´ ì¹´ìš´íŠ¸\nâ€¢ ë¬¼ë¥˜ ì ì¬ í˜„í™© (S/M/L)\nâ€¢ ì›í…Œì´í¬ ì§„í–‰ ìƒíƒœ\n\nâš ï¸ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                socket.emit('reset_all');
                addEvent('info', 'ì „ì²´ ì´ˆê¸°í™” ìš”ì²­ë¨');
            }
        });
        
        // ì´ˆê¸°í™” ê²°ê³¼ ì‘ë‹µ
        socket.on('reset_all_result', (data) => {
            if (data.success) {
                addEvent('info', 'âœ… ì „ì²´ ì´ˆê¸°í™” ì™„ë£Œ');
            } else {
                addEvent('error', 'âŒ ì´ˆê¸°í™” ì‹¤íŒ¨: ' + data.message);
            }
        });
        
        // ì›í…Œì´í¬ ì‹œë‚˜ë¦¬ì˜¤ ì‘ë‹µ
        socket.on('one_take_result', (data) => {
            if (data.success) {
                document.getElementById('sort-message').innerHTML = 'ğŸ¬ ' + (data.message || 'ì›í…Œì´í¬ ì§„í–‰ ì¤‘...');
                addSortLog('âœ… ' + (data.message || 'ì‹œì‘ë¨'));
            } else {
                document.getElementById('sort-message').innerHTML = 'âŒ ' + (data.message || 'ì‹¤íŒ¨');
                addSortLog('âŒ ' + (data.message || 'ì‹¤íŒ¨'));
            }
        });
        
        // ë¡œë´‡ ìƒíƒœ ì‘ë‹µ ì²˜ë¦¬
        socket.on('robot_state', (data) => {
            const stateColors = {
                'STANDBY': '#4caf50',
                'MOVING': '#2196f3',
                'SAFE_STOP': '#ff9800',
                'EMERGENCY_STOP': '#f44336',
                'RECOVERY': '#9c27b0',
                'SAFE_OFF': '#ff5722',
                'INITIALIZING': '#607d8b',
                'TEACHING': '#00bcd4'
            };
            const color = stateColors[data.name] || '#888';
            document.getElementById('robot-state-display').style.display = 'block';
            document.getElementById('robot-state-text').innerHTML = `<span style="color: ${color}; font-weight: bold;">${data.name}</span>`;
        });
        
        // ì¶©ëŒ ë³µêµ¬ ì‹œì‘ ì‘ë‹µ
        socket.on('collision_recovery_started', (data) => {
            if (data.success) {
                document.getElementById('sort-message').innerHTML = 'ğŸ”§ ë³µêµ¬ ì‹œí€€ìŠ¤ ì§„í–‰ ì¤‘...';
                addSortLog('âœ… ë³µêµ¬ ì‹œí€€ìŠ¤ ì‹œì‘ë¨');
            } else {
                document.getElementById('sort-message').innerHTML = `âŒ ë³µêµ¬ ì‹¤íŒ¨: ${data.error}`;
                document.getElementById('robot-state-text').textContent = `ì‹¤íŒ¨: ${data.error}`;
                document.getElementById('robot-state-text').style.color = '#f44336';
                addSortLog(`âŒ ë³µêµ¬ ì‹¤íŒ¨: ${data.error}`);
            }
        });
        
        // ë¶„ë¥˜ ìƒíƒœ ìˆ˜ì‹  (UI ì—…ë°ì´íŠ¸)
        // ë³„ë„ í•¸ë“¤ëŸ¬ë¡œ ì²˜ë¦¬ë¨
        
        // ë¶„ë¥˜ ë¡œê·¸ ìˆ˜ì‹ 
        socket.on('sort_log', (data) => {
            addSortEvent('info', data.message);
        });
        
        // â˜… ë¶„ë¥˜ ì´ë²¤íŠ¸ ë°°ì—´ (ìµœëŒ€ 10ê°œ)
        let sortEventHistory = [];
        const MAX_SORT_EVENTS = 10;
        
        // â˜… ë¶„ë¥˜ ì´ë²¤íŠ¸ ì¶”ê°€ í•¨ìˆ˜
        function addSortEvent(type, description) {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ko-KR');
            
            const eventTypes = {
                'start': { label: 'ì‹œì‘', color: '#00b894', bg: 'rgba(0,184,148,0.2)' },
                'stop': { label: 'ì •ì§€', color: '#e74c3c', bg: 'rgba(231,76,60,0.2)' },
                'pick': { label: 'PICK', color: '#e67e22', bg: 'rgba(230,126,34,0.2)' },
                'place': { label: 'PLACE', color: '#9b59b6', bg: 'rgba(155,89,182,0.2)' },
                'small': { label: 'SMALL', color: '#2ecc71', bg: 'rgba(46,204,113,0.2)' },
                'medium': { label: 'MEDIUM', color: '#f1c40f', bg: 'rgba(241,196,15,0.2)' },
                'long': { label: 'LONG', color: '#e74c3c', bg: 'rgba(231,76,60,0.2)' },
                'conveyor': { label: 'ì»¨ë² ì´ì–´', color: '#3498db', bg: 'rgba(52,152,219,0.2)' },
                'home': { label: 'í™ˆ', color: '#00d4ff', bg: 'rgba(0,212,255,0.2)' },
                'recovery': { label: 'ë³µêµ¬', color: '#ff9800', bg: 'rgba(255,152,0,0.2)' },
                'error': { label: 'ì˜¤ë¥˜', color: '#e74c3c', bg: 'rgba(231,76,60,0.2)' },
                'info': { label: 'ì •ë³´', color: '#888', bg: 'rgba(136,136,136,0.2)' }
            };
            
            const evt = eventTypes[type] || eventTypes['info'];
            
            sortEventHistory.unshift({
                time: timeStr,
                type: type,
                label: evt.label,
                color: evt.color,
                bg: evt.bg,
                description: description
            });
            
            if (sortEventHistory.length > MAX_SORT_EVENTS) {
                sortEventHistory = sortEventHistory.slice(0, MAX_SORT_EVENTS);
            }
            
            updateSortEventTable();
        }
        
        // â˜… ë¶„ë¥˜ ì´ë²¤íŠ¸ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateSortEventTable() {
            const tbody = document.getElementById('sort-event-tbody');
            if (!tbody) return;
            
            tbody.innerHTML = sortEventHistory.map((evt, idx) => `
                <tr class="event-row" style="border-bottom: 1px solid rgba(255,255,255,0.05); ${idx === 0 ? 'animation: highlight-new 1s ease;' : ''}">
                    <td style="padding: 10px 12px; color: #888; font-family: monospace; font-size: 0.85em;">${evt.time}</td>
                    <td style="padding: 10px 12px; text-align: center;">
                        <span style="padding: 3px 8px; border-radius: 4px; background: ${evt.bg}; color: ${evt.color}; font-size: 0.8em;">${evt.label}</span>
                    </td>
                    <td style="padding: 10px 12px; color: #ccc; font-size: 0.9em;">${evt.description}</td>
                </tr>
            `).join('');
        }
        
        // í˜¸í™˜ì„±ì„ ìœ„í•œ ê¸°ì¡´ í•¨ìˆ˜ ìœ ì§€ (ìƒˆ í•¨ìˆ˜ë¡œ ì—°ê²°)
        function addSortLog(message) {
            // ë©”ì‹œì§€ ë‚´ìš©ì— ë”°ë¼ ì ì ˆí•œ ì´ë²¤íŠ¸ íƒ€ì… ê²°ì •
            let type = 'info';
            if (message.includes('ë¶„ë¥˜ ì‹œì‘') || message.includes('ì‹œì‘')) type = 'start';
            else if (message.includes('ë¹„ìƒì •ì§€') || message.includes('ì •ì§€')) type = 'stop';
            else if (message.includes('SMALL')) type = 'small';
            else if (message.includes('MEDIUM')) type = 'medium';
            else if (message.includes('LONG')) type = 'long';
            else if (message.includes('ì»¨ë² ì´ì–´')) type = 'conveyor';
            else if (message.includes('í™ˆ')) type = 'home';
            else if (message.includes('ë³µêµ¬')) type = 'recovery';
            else if (message.includes('ì˜¤ë¥˜') || message.includes('ì‹¤íŒ¨')) type = 'error';
            
            addSortEvent(type, message);
        }
        
        // ë¶„ë¥˜ ê²°ê³¼ ìˆ˜ì‹  (ê° ë¶„ë¥˜ ì™„ë£Œì‹œ)
        socket.on('sort_result', (data) => {
            const classification = data.classification;
            const width = data.width;
            const type = classification?.toLowerCase() || 'info';
            addSortEvent(type, `ğŸ“¦ ${classification} ë¶„ë¥˜ ì™„ë£Œ (í­: ${width?.toFixed(1) ?? '-'}mm)`);
        });
        
        // ===== ì»¨ë² ì´ì–´ ì—°ë™ ê¸°ëŠ¥ =====
        let conveyorModeActive = false;
        
        // ì»¨ë² ì´ì–´ ìë™ ëª¨ë“œ í† ê¸€
        document.getElementById('btn-conveyor-mode')?.addEventListener('click', () => {
            conveyorModeActive = !conveyorModeActive;
            socket.emit('conveyor_mode', { enabled: conveyorModeActive });
            
            const btn = document.getElementById('btn-conveyor-mode');
            if (conveyorModeActive) {
                btn.innerHTML = 'â¹ï¸ ìë™ ëª¨ë“œ ë¹„í™œì„±í™”';
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-danger');
                addSortLog('ğŸ”„ ì»¨ë² ì´ì–´ ìë™ ëª¨ë“œ í™œì„±í™”');
            } else {
                btn.innerHTML = 'ğŸ”„ ìë™ ëª¨ë“œ í™œì„±í™”';
                btn.classList.remove('btn-danger');
                btn.classList.add('btn-primary');
                addSortLog('â¹ï¸ ì»¨ë² ì´ì–´ ìë™ ëª¨ë“œ ë¹„í™œì„±í™”');
            }
        });
        
        // ì»¨ë² ì´ì–´ ìˆ˜ë™ ì¬ì‹œì‘
        document.getElementById('btn-conveyor-resume')?.addEventListener('click', () => {
            socket.emit('conveyor_resume');
            addSortLog('â–¶ï¸ ì»¨ë² ì´ì–´ ì¬ì‹œì‘ ìš”ì²­');
        });
        
        // ë¶„ë¥˜ ìƒíƒœ ìˆ˜ì‹  (ì»¨ë² ì´ì–´ ìƒíƒœ í¬í•¨)
        socket.on('sort_status', (data) => {
            // ê¸°ì¡´ ë¶„ë¥˜ ìƒíƒœ ì—…ë°ì´íŠ¸
            const statusIcon = document.getElementById('sort-status-icon');
            const statusText = document.getElementById('sort-status-text');
            const phaseText = document.getElementById('sort-phase');
            const dsrStatus = document.getElementById('sort-dsr-status');
            const lastWidth = document.getElementById('sort-last-width');
            
            // dlar_sort_nodeì—ì„œ ì˜¤ëŠ” í•„ë“œëª…: is_running, is_paused, current_phase, last_classification, dsr_ready, small, medium, large
            if (data.is_running) {
                if (data.is_paused) {
                    statusIcon.textContent = 'â¸ï¸';
                    statusText.textContent = 'ì¼ì‹œì •ì§€';
                    statusText.style.color = '#fdcb6e';
                } else {
                    statusIcon.textContent = 'ğŸ”„';
                    statusText.textContent = 'ì‘ì—… ì¤‘';
                    statusText.style.color = '#00b894';
                }
            } else {
                if (data.waiting_for_object) {
                    statusIcon.textContent = 'ğŸ‘€';
                    statusText.textContent = 'ë¬¼ì²´ ëŒ€ê¸°';
                    statusText.style.color = '#74b9ff';
                } else {
                    statusIcon.textContent = 'â¸ï¸';
                    statusText.textContent = 'ëŒ€ê¸° ì¤‘';
                    statusText.style.color = '#00d4ff';
                }
            }
            
            // í˜„ì¬ ì‹œí€€ìŠ¤ (ê°’ë§Œ í‘œì‹œ)
            if (phaseText) phaseText.textContent = data.current_phase || '--';
            if (dsrStatus) dsrStatus.textContent = 'DSR ë¡œë´‡: ' + (data.dsr_ready ? 'âœ… ì—°ê²°ë¨' : 'âŒ ì—°ê²° ì•ˆë¨');
            if (lastWidth) lastWidth.textContent = data.last_classification ?? '--';
            
            // íƒ€ì…ë³„ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            const smallCount = document.getElementById('sort-small-count');
            const mediumCount = document.getElementById('sort-medium-count');
            const longCount = document.getElementById('sort-long-count');
            if (smallCount) smallCount.textContent = data.small ?? 0;
            if (mediumCount) mediumCount.textContent = data.medium ?? 0;
            if (longCount) longCount.textContent = data.large ?? 0;
            
            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ (ê°„ì†Œí™”ëœ UI)
            const startBtn = document.getElementById('btn-sort-start');
            
            if (startBtn) {
                if (data.is_running && !data.is_paused) {
                    // ì‹¤í–‰ ì¤‘ - ë¹„ìƒì •ì§€ ë²„íŠ¼ìœ¼ë¡œ í‘œì‹œ
                    startBtn.innerHTML = 'ğŸ›‘ ë¹„ìƒì •ì§€';
                    startBtn.className = 'btn';
                    startBtn.style.background = 'linear-gradient(135deg, #c0392b, #e74c3c)';
                    startBtn.style.color = 'white';
                    sortRunning = true;
                } else {
                    // ì •ì§€/ì¼ì‹œì •ì§€ ìƒíƒœ - ì‹œì‘ ë²„íŠ¼ìœ¼ë¡œ í‘œì‹œ
                    startBtn.innerHTML = 'â–¶ï¸ ë¶„ë¥˜ ì‹œì‘';
                    startBtn.className = 'btn btn-success';
                    startBtn.style.background = '';
                    startBtn.style.color = '';
                    sortRunning = false;
                }
            }
            
            // ì»¨ë² ì´ì–´ ìƒíƒœ ì—…ë°ì´íŠ¸
            const convStatusIcon = document.getElementById('conveyor-status-icon');
            const convStatusText = document.getElementById('conveyor-status-text');
            const convDetectIcon = document.getElementById('conveyor-detect-icon');
            const convDetectText = document.getElementById('conveyor-detect-text');
            const convAutoText = document.getElementById('conveyor-auto-text');
            const convModeBtn = document.getElementById('btn-conveyor-mode');
            
            // ì»¨ë² ì´ì–´ ëª¨ë“œ
            if (data.conveyor_mode !== undefined) {
                conveyorModeActive = data.conveyor_mode;
                if (convAutoText) {
                    convAutoText.textContent = data.conveyor_mode ? 'âœ… í™œì„±' : 'ë¹„í™œì„±';
                    convAutoText.style.color = data.conveyor_mode ? '#00b894' : '#888';
                }
                if (convModeBtn) {
                    if (data.conveyor_mode) {
                        convModeBtn.innerHTML = 'â¹ï¸ ìë™ ëª¨ë“œ ë¹„í™œì„±í™”';
                        convModeBtn.classList.remove('btn-primary');
                        convModeBtn.classList.add('btn-danger');
                    } else {
                        convModeBtn.innerHTML = 'ğŸ”„ ìë™ ëª¨ë“œ í™œì„±í™”';
                        convModeBtn.classList.remove('btn-danger');
                        convModeBtn.classList.add('btn-primary');
                    }
                }
            }
            
            // ë¬¼ì²´ ê°ì§€ ìƒíƒœ
            if (data.conveyor_detected !== undefined) {
                if (convDetectIcon) convDetectIcon.textContent = data.conveyor_detected ? 'ğŸ“¦âœ¨' : 'ğŸ“¦';
                if (convDetectText) {
                    convDetectText.textContent = data.conveyor_detected ? 'âœ… ê°ì§€ë¨!' : 'ê°ì§€ ì•ˆë¨';
                    convDetectText.style.color = data.conveyor_detected ? '#00b894' : '#888';
                }
            }
            
            // ëŒ€ê¸° ìƒíƒœ
            if (data.waiting_for_object !== undefined && convStatusIcon && convStatusText) {
                if (data.waiting_for_object) {
                    convStatusIcon.textContent = 'ğŸŸ¢';
                    convStatusText.textContent = 'ë¬¼ì²´ ëŒ€ê¸° ì¤‘';
                    convStatusText.style.color = '#00b894';
                } else if (data.is_running) {
                    convStatusIcon.textContent = 'ğŸŸ¡';
                    convStatusText.textContent = 'ì‘ì—… ì¤‘';
                    convStatusText.style.color = '#fdcb6e';
                } else {
                    convStatusIcon.textContent = 'âš«';
                    convStatusText.textContent = 'ëŒ€ê¸°';
                    convStatusText.style.color = '#888';
                }
            }
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            const smallEl = document.getElementById('sort-small');
            const mediumEl = document.getElementById('sort-medium');
            const largeEl = document.getElementById('sort-large');
            const completedEl = document.getElementById('sort-completed');
            const errorsEl = document.getElementById('sort-errors');
            
            if (smallEl) smallEl.textContent = data.small ?? 0;
            if (mediumEl) mediumEl.textContent = data.medium ?? 0;
            if (largeEl) largeEl.textContent = data.large ?? 0;
            if (completedEl) completedEl.textContent = data.completed ?? 0;
            if (errorsEl) errorsEl.textContent = data.errors ?? 0;
            
            // â˜… ë°ì´í„° íƒ­ ì—…ë°ì´íŠ¸
            updateDataTab(data);
        });
        
        // â˜… ì´ë²¤íŠ¸ ê¸°ë¡ ë°°ì—´ (ìµœëŒ€ 10ê°œ ìœ ì§€)
        let eventHistory = [];
        const MAX_EVENTS = 10;
        let lastAction = null;
        let lastClassification = null;
        
        // â˜… ì´ë²¤íŠ¸ ì¶”ê°€ í•¨ìˆ˜
        function addEvent(type, description) {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ko-KR');
            
            const eventTypes = {
                'start': { label: 'ì‹œì‘', color: '#00b894', bg: 'rgba(0,184,148,0.2)' },
                'pick': { label: 'PICK', color: '#e67e22', bg: 'rgba(230,126,34,0.2)' },
                'place': { label: 'PLACE', color: '#9b59b6', bg: 'rgba(155,89,182,0.2)' },
                'classify': { label: 'ë¶„ë¥˜', color: '#f1c40f', bg: 'rgba(241,196,15,0.2)' },
                'complete': { label: 'ì™„ë£Œ', color: '#2ecc71', bg: 'rgba(46,204,113,0.2)' },
                'error': { label: 'ì˜¤ë¥˜', color: '#e74c3c', bg: 'rgba(231,76,60,0.2)' },
                'info': { label: 'ì •ë³´', color: '#888', bg: 'rgba(136,136,136,0.2)' }
            };
            
            const evt = eventTypes[type] || eventTypes['info'];
            
            // ìƒˆ ì´ë²¤íŠ¸ ì¶”ê°€
            eventHistory.unshift({
                time: timeStr,
                type: type,
                label: evt.label,
                color: evt.color,
                bg: evt.bg,
                description: description
            });
            
            // ìµœëŒ€ 10ê°œ ìœ ì§€
            if (eventHistory.length > MAX_EVENTS) {
                eventHistory = eventHistory.slice(0, MAX_EVENTS);
            }
            
            // í…Œì´ë¸” ì—…ë°ì´íŠ¸
            updateEventTable();
        }
        
        // â˜… ì´ë²¤íŠ¸ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateEventTable() {
            const tbody = document.getElementById('data-event-tbody');
            if (!tbody) return;
            
            tbody.innerHTML = eventHistory.map((evt, idx) => `
                <tr class="event-row" style="border-bottom: 1px solid rgba(255,255,255,0.05); ${idx === 0 ? 'animation: highlight-new 1s ease;' : ''}">
                    <td style="padding: 10px 12px; color: #888; font-family: monospace; font-size: 0.85em;">${evt.time}</td>
                    <td style="padding: 10px 12px; text-align: center;">
                        <span style="padding: 3px 8px; border-radius: 4px; background: ${evt.bg}; color: ${evt.color}; font-size: 0.8em;">${evt.label}</span>
                    </td>
                    <td style="padding: 10px 12px; color: #ccc; font-size: 0.9em;">${evt.description}</td>
                </tr>
            `).join('');
        }
        
        // â˜… ë°ì´í„° íƒ­ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateDataTab(data) {
            // ìš”ì•½ í…Œì´ë¸” ì—…ë°ì´íŠ¸
            const robotStatus = document.getElementById('data-robot-status');
            const robotStatusText = document.getElementById('data-robot-status-text');
            const currentAction = document.getElementById('data-current-action');
            const gripperStatus = document.getElementById('data-gripper-status');
            const smallCount = document.getElementById('data-small-count');
            const mediumCount = document.getElementById('data-medium-count');
            const longCount = document.getElementById('data-long-count');
            const lastClass = document.getElementById('data-last-class');
            
            // ë¡œë´‡ ìƒíƒœ
            if (robotStatus && robotStatusText) {
                if (data.is_running) {
                    robotStatus.style.color = '#00b894';
                    robotStatus.textContent = 'â—';
                    robotStatusText.textContent = 'ì‘ì—…ì¤‘';
                } else {
                    robotStatus.style.color = '#888';
                    robotStatus.textContent = 'â—';
                    robotStatusText.textContent = 'ëŒ€ê¸°';
                }
            }
            
            // í˜„ì¬ ì‘ì—… ë‹¨ê³„
            if (currentAction && data.current_action) {
                currentAction.textContent = data.current_action;
                const actionColors = {
                    'idle': '#888',
                    'approaching_pick': '#3498db',
                    'picking': '#e67e22',
                    'picked': '#27ae60',
                    'approaching_place': '#9b59b6',
                    'placing': '#e74c3c',
                    'placed': '#2ecc71',
                    'returning_home': '#00d4ff'
                };
                currentAction.style.color = actionColors[data.current_action] || '#3498db';
                
                // ì‘ì—… ë‹¨ê³„ ë³€ê²½ì‹œ ì´ë²¤íŠ¸ ì¶”ê°€
                if (data.current_action !== lastAction) {
                    if (data.current_action === 'picking') {
                        addEvent('pick', 'ë¬¼ì²´ ì§‘ëŠ” ì¤‘...');
                    } else if (data.current_action === 'placing') {
                        addEvent('place', 'ë¬¼ì²´ ë°°ì¹˜ ì¤‘...');
                    } else if (data.current_action === 'placed') {
                        addEvent('complete', `ì‚¬ì´í´ ì™„ë£Œ (${data.last_classification || '--'})`);
                    } else if (data.current_action === 'idle' && lastAction === 'returning_home') {
                        addEvent('info', 'í™ˆ ìœ„ì¹˜ ë³µê·€ ì™„ë£Œ');
                    }
                    lastAction = data.current_action;
                }
            }
            
            // ê·¸ë¦¬í¼ ìƒíƒœ
            if (gripperStatus) {
                gripperStatus.textContent = data.gripping ? 'ğŸ”’' : 'ğŸ”“';
            }
            
            // ì ì¬ ì¹´ìš´íŠ¸
            if (smallCount) smallCount.textContent = data.small ?? 0;
            if (mediumCount) mediumCount.textContent = data.medium ?? 0;
            if (longCount) longCount.textContent = data.large ?? 0;
            
            // ë§ˆì§€ë§‰ ë¶„ë¥˜
            if (lastClass) {
                lastClass.textContent = data.last_classification ?? '--';
                const classColors = {
                    'SMALL': '#2ecc71',
                    'MEDIUM': '#f1c40f',
                    'LONG': '#e74c3c'
                };
                lastClass.style.color = classColors[data.last_classification] || '#fdcb6e';
                
                // ë¶„ë¥˜ ë³€ê²½ì‹œ ì´ë²¤íŠ¸ ì¶”ê°€
                if (data.last_classification && data.last_classification !== lastClassification) {
                    addEvent('classify', `${data.last_classification} ë¶„ë¥˜ë¨`);
                    lastClassification = data.last_classification;
                }
            }
            
            // ë³µêµ¬ ì •ë³´
            const restartCount = document.getElementById('recovery-restart-count');
            const crashReason = document.getElementById('recovery-crash-reason');
            const targetPlace = document.getElementById('recovery-target-place');
            
            if (restartCount) restartCount.textContent = data.system_restart_count ?? 0;
            if (crashReason) crashReason.textContent = data.last_crash_reason ?? 'ì—†ìŒ';
            if (targetPlace) {
                if (data.target_place_position) {
                    targetPlace.textContent = `X: ${data.target_place_position[0]?.toFixed(1)}, Y: ${data.target_place_position[1]?.toFixed(1)}, Z: ${data.target_place_position[2]?.toFixed(1)}`;
                } else {
                    targetPlace.textContent = '--';
                }
            }
            
            // ë§ˆì§€ë§‰ ì—…ë¡œë“œ ì‹œê°„
            const lastUploadEl = document.getElementById('firebase-last-upload');
            if (lastUploadEl) {
                const now = new Date();
                lastUploadEl.textContent = now.toLocaleTimeString('ko-KR');
            }
            
            // â˜… Firebase Raw JSON ì—…ë°ì´íŠ¸
            const rawJsonEl = document.getElementById('firebase-raw-json');
            const jsonSizeEl = document.getElementById('firebase-json-size');
            if (rawJsonEl) {
                const firebaseData = {
                    timestamp: new Date().toISOString(),
                    robot_state: data.is_running ? 'ì‘ì—… ì¤‘' : 'ëŒ€ê¸°',
                    current_action: data.current_action ?? 'idle',
                    gripping: data.gripping ?? false,
                    classification: {
                        small: data.small ?? 0,
                        medium: data.medium ?? 0,
                        long: data.large ?? 0,
                        last: data.last_classification ?? null
                    },
                    recovery: {
                        restart_count: data.system_restart_count ?? 0,
                        crash_reason: data.last_crash_reason ?? null,
                        target_place: data.target_place_position ?? null
                    }
                };
                const jsonStr = JSON.stringify(firebaseData, null, 2);
                rawJsonEl.textContent = jsonStr;
                
                if (jsonSizeEl) {
                    const bytes = new Blob([jsonStr]).size;
                    jsonSizeEl.textContent = `${bytes} bytes`;
                }
            }
        }
        
        // =============================================
        // ğŸ§± ì ì¬ íƒ­ í•¸ë“¤ëŸ¬
        // =============================================
        let stackingRunning = false;
        
        // ì ì¬ ë¡œê·¸ ì¶”ê°€
        function addStackingLog(message) {
            const logDiv = document.getElementById('stacking-log');
            if (logDiv) {
                const time = new Date().toLocaleTimeString('ko-KR');
                const entry = document.createElement('div');
                entry.innerHTML = `<span style="color: #666;">[${time}]</span> ${message}`;
                logDiv.insertBefore(entry, logDiv.firstChild);
                
                // ìµœëŒ€ 20ê°œ ìœ ì§€
                while (logDiv.children.length > 20) {
                    logDiv.removeChild(logDiv.lastChild);
                }
            }
        }
        
        // ì ì¬ ì‹œì‘ ë²„íŠ¼
        document.getElementById('btn-stacking-start')?.addEventListener('click', () => {
            if (confirm('ğŸ“¦ 2ì°¨ ì ì¬ë¥¼ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nìˆœì„œ: MEDIUM â†’ LARGE â†’ LARGE â†’ MEDIUM â†’ SMALL â†’ SMALL\n\nâ€» 1ì°¨ ë¶„ë¥˜ê°€ ì™„ë£Œëœ ìƒíƒœì—ì„œ ì‹¤í–‰í•˜ì„¸ìš”.')) {
                socket.emit('stacking_start');
                stackingRunning = true;
                document.getElementById('stacking-message').innerHTML = 'ğŸ“¦ ì ì¬ ì‹œì‘ ì¤‘...';
                document.getElementById('stacking-message').style.color = '#4caf50';
                addStackingLog('ğŸ“¦ 2ì°¨ ì ì¬ ì‹œì‘');
            }
        });
        
        // ì ì¬ ì •ì§€ ë²„íŠ¼
        document.getElementById('btn-stacking-stop')?.addEventListener('click', () => {
            socket.emit('emergency_stop');
            stackingRunning = false;
            document.getElementById('stacking-message').innerHTML = 'â¹ï¸ ì ì¬ ì •ì§€ë¨';
            document.getElementById('stacking-message').style.color = '#f44336';
            addStackingLog('â¹ï¸ ì ì¬ ì •ì§€');
        });
        
        // ì ì¬ ì§„í–‰ ìƒíƒœ ìˆ˜ì‹  (ì‹¤ì‹œê°„)
        socket.on('stacking_progress', (data) => {
            const step = data.step || 0;
            const total = data.total || 6;
            const percent = data.percent || 0;
            const message = data.message || '';
            
            // ì§„í–‰ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.getElementById('stacking-current').textContent = step;
            document.getElementById('stacking-progress').textContent = percent + '%';
            document.getElementById('stacking-progress-bar').style.width = percent + '%';
            document.getElementById('stacking-message').innerHTML = 'ğŸ”„ ' + message;
            document.getElementById('stacking-message').style.color = '#2196f3';
            
            // ë¡œê·¸ ì¶”ê°€
            if (data.box_info) {
                addStackingLog(`ğŸ“¦ [${step}/${total}] ${data.box_info.width_class} ê·¸ë¦½${(data.box_info.pick_idx||0)+1} â†’ ì ì¬${(data.box_info.place_idx||0)+1}`);
            } else {
                addStackingLog(`ğŸ”„ ${message}`);
            }
            
            // ìˆœì„œ ë°•ìŠ¤ í•˜ì´ë¼ì´íŠ¸
            document.querySelectorAll('.stacking-step').forEach((el, idx) => {
                if (idx < step) {
                    el.style.borderColor = '#4caf50';
                    el.style.opacity = '0.6';
                } else if (idx === step - 1) {
                    el.style.borderColor = '#e91e63';
                    el.style.opacity = '1';
                    el.style.boxShadow = '0 0 10px #e91e63';
                } else {
                    el.style.borderColor = '#333';
                    el.style.opacity = '1';
                    el.style.boxShadow = 'none';
                }
            });
        });
        
        // ì ì¬ ê²°ê³¼ ìˆ˜ì‹ 
        socket.on('stacking_result', (data) => {
            if (data.success) {
                document.getElementById('stacking-message').innerHTML = 'âœ… ' + (data.message || 'ì ì¬ ì™„ë£Œ');
                document.getElementById('stacking-message').style.color = '#4caf50';
                addStackingLog('âœ… ' + (data.message || 'ì™„ë£Œ'));
            } else {
                document.getElementById('stacking-message').innerHTML = 'âŒ ' + (data.message || 'ì‹¤íŒ¨');
                document.getElementById('stacking-message').style.color = '#f44336';
                addStackingLog('âŒ ' + (data.message || 'ì‹¤íŒ¨'));
            }
            stackingRunning = false;
        });
        
        // ì›í…Œì´í¬ ìƒíƒœ ìˆ˜ì‹  (ì ì¬ ì§„í–‰ ìƒíƒœ ì—…ë°ì´íŠ¸)
        socket.on('one_take_status', (data) => {
            // ë‹¨ê³„ í‘œì‹œ
            const phaseEl = document.getElementById('stacking-phase');
            if (phaseEl) {
                phaseEl.textContent = data.phase || 'IDLE';
                phaseEl.style.color = data.phase === 'STACKING' ? '#e91e63' : 
                                       data.phase === 'SORTING' ? '#2196f3' : 
                                       data.phase === 'COMPLETE' ? '#4caf50' : '#9c27b0';
            }
            
            // ì§„í–‰ ìƒíƒœ í‘œì‹œ
            const step = data.stacking_step || 0;
            document.getElementById('stacking-current').textContent = step;
            document.getElementById('stacking-progress').textContent = Math.round((step / 6) * 100) + '%';
            document.getElementById('stacking-progress-bar').style.width = Math.round((step / 6) * 100) + '%';
            
            // ìˆœì„œ ë°•ìŠ¤ í•˜ì´ë¼ì´íŠ¸
            document.querySelectorAll('.stacking-step').forEach((el, idx) => {
                if (idx < step) {
                    el.style.borderColor = '#4caf50';
                    el.style.opacity = '0.6';
                } else if (idx === step && data.phase === 'STACKING') {
                    el.style.borderColor = '#e91e63';
                    el.style.opacity = '1';
                    el.style.boxShadow = '0 0 10px #e91e63';
                } else {
                    el.style.borderColor = '#333';
                    el.style.opacity = '1';
                    el.style.boxShadow = 'none';
                }
            });
        });
    </script>
</body>
</html>
