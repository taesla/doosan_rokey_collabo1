#!/usr/bin/env python3
"""
로봇 좌표 설정 모듈
모든 위치 좌표값을 한 곳에서 관리
형식: [x, y, z, rx, ry, rz] (mm, deg)

robot_pick_node/dlar_sort/config.py 기준 업데이트
"""

# =========================================
# 홈 위치
# =========================================
HOME_POSITION = [367.53, 4.02, 203.18, 164.67, -179.96, 164.99]

# =========================================
# 픽업 위치 (컨베이어) - 티칭 데이터 전체 반영
# =========================================
PICK_POSITION = [642.382, 55.86, 155.81, 179.72, 179.11, 179.89]

# =========================================
# 컨베이어 시작점 (복구 시 블럭 반납 위치)
# =========================================
CONVEY_START_POINT = [117.84, -231.69, 124.66, 164.61, -179.96, 164.93]

# =========================================
# 팔레트 배치 위치 (크기별) - robot_pick_node 기준
# =========================================
# LARGE/LONG (긴 물체)
PLACE_LARGE = [467.010, 256.990, 83.550, 97.63, -179.7, 98.44]

# SMALL (작은 물체)
PLACE_SMALL = [176.91, 262.440, 62.130, 42.19, -179.74, 43.06]

# MEDIUM (중간 물체)
PLACE_MEDIUM = [325.330, 254.27, 51.860, 26.16, -178.83, 26.31]

# =========================================
# 배치 위치 딕셔너리 (편의용)
# =========================================
PLACE_POSITIONS = {
    'SMALL': PLACE_SMALL,
    'MEDIUM': PLACE_MEDIUM,
    'LONG': PLACE_LARGE,
    'LARGE': PLACE_LARGE,  # alias
}

# =========================================
# 클래스별 적재 좌표 테이블 (robot_pick_node 기준)
# 각 슬롯별 (x, y, z, rx, ry, rz) 전체 좌표 - 고정 좌표 방식
# =========================================
PLACE_POS_TABLE = {
    "SMALL": [
        # SMALL 1번 적재 위치
        (176.91, 262.440, 62.130, 42.19, -179.74, 43.06),
        # SMALL 2번 적재 위치
        (176.91, 262.440, 104.84, 73.66, -178.25, 74.21),
    ],
    "MEDIUM": [
        # MEDIUM 1번 적재 위치 (같은 자리에 쌓음)
        (325.330, 254.27, 51.860, 26.16, -178.83, 26.31),
        # MEDIUM 2번 적재 위치
        (325.330, 254.27, 94.75, 26.82, -178.63, 27.02),
    ],
    "LONG": [
        # LONG 1번 적재 위치 (같은 자리에 쌓음)
        (467.010, 256.990, 83.550, 97.63, -179.7, 98.44),
        # LONG 2번 적재 위치
        (467.010, 256.990, 144.63, 43.89, -179.28, -44.84),
    ],
}

# =========================================
# 분류별 바닥 면적 (mm) - 층별 적재용
# =========================================
CLASS_FOOTPRINT = {
    "SMALL": (30.0, 30.0),
    "MEDIUM": (63.0, 63.0),
    "LONG": (80.0, 95.0),
}

# =========================================
# Tool 회전 옵션 (배치 시)
# =========================================
PLACE_ROTATE_ENABLED = True
PLACE_ROTATE_DEG = 90.0


def normalize_angle_deg(angle: float) -> float:
    """각도를 [-180, 180] 범위로 정규화"""
    a = ((angle + 180.0) % 360.0) - 180.0
    return 180.0 if a == -180.0 else a


def get_place_position(width_class: str) -> list:
    """
    물체 크기에 따른 배치 위치 반환
    
    Args:
        width_class: 'SMALL', 'MEDIUM', 'LONG', 'LARGE'
        
    Returns:
        배치 좌표 리스트 [x, y, z, rx, ry, rz]
    """
    return PLACE_POSITIONS.get(width_class, HOME_POSITION).copy()


def get_footprint(width_class: str) -> tuple:
    """분류별 바닥 면적 반환 (bw, bd)"""
    return CLASS_FOOTPRINT.get(width_class, (30.0, 30.0))
