#!/usr/bin/env python3
"""
로봇 좌표 설정 모듈
모든 위치 좌표값을 한 곳에서 관리
형식: [x, y, z, rx, ry, rz] (mm, deg)

robot_pick_node/dlar_sort/config.py 기준 업데이트
"""

# =========================================
# 홈 위치
# =========================================
HOME_POSITION = [367.53, 4.02, 203.18, 164.67, -179.96, 164.99]

# =========================================
# 픽업 위치 (컨베이어)
# =========================================
PICK_POSITION = [401.99, -235.44, 153.98, 53.98, 179.23, 56.08]

# =========================================
# 컨베이어 시작점 (복구 시 블럭 반납 위치)
# =========================================
CONVEY_START_POINT = [117.84, -231.69, 124.66, 164.61, -179.96, 164.93]

# =========================================
# 팔레트 배치 위치 (크기별) - robot_pick_node 기준
# =========================================
# LARGE/LONG (긴 물체)
PLACE_LARGE = [669.98, 230.15, 143.57, 161.18, -179.97, 161.50]

# SMALL (작은 물체)
PLACE_SMALL = [238.56, 230.09, 143.57, 133.74, -179.98, 134.06]

# MEDIUM (중간 물체)
PLACE_MEDIUM = [429.27, 230.15, 143.57, 161.18, -179.97, 161.50]

# =========================================
# 배치 위치 딕셔너리 (편의용)
# =========================================
PLACE_POSITIONS = {
    'SMALL': PLACE_SMALL,
    'MEDIUM': PLACE_MEDIUM,
    'LONG': PLACE_LARGE,
    'LARGE': PLACE_LARGE,  # alias
}

# =========================================
# 클래스별 적재 좌표 테이블 (robot_pick_node 기준)
# 각각 (x, y)만 관리, Z는 z_touch 기반 계산값을 사용
# =========================================
PLACE_POS_TABLE = {
    "SMALL": [
        # SMALL 1번 적재 위치
        (135.30609130859375, 289.3660888671875),
        # SMALL 2번 적재 위치
        (135.30609130859375, 249.3660888671875),
        # SMALL 3번 적재 위치
        (135.30609130859375, 209.3660888671875),
    ],
    "MEDIUM": [
        # MEDIUM 1번 적재 위치 (같은 자리에 쌓음)
        (297.98492431640625, 245.0819091796875),
        # MEDIUM 2번 적재 위치
        (297.98492431640625, 245.0819091796875),
        # MEDIUM 3번 적재 위치
        (297.98492431640625, 245.0819091796875),
    ],
    "LONG": [
        # LONG 1번 적재 위치 (같은 자리에 쌓음)
        (461.306640625, 245.54345703125),
        # LONG 2번 적재 위치
        (461.306640625, 245.54345703125),
        # LONG 3번 적재 위치
        (461.306640625, 245.54345703125),
    ],
}

# =========================================
# 분류별 바닥 면적 (mm) - 층별 적재용
# =========================================
CLASS_FOOTPRINT = {
    "SMALL": (30.0, 30.0),
    "MEDIUM": (63.0, 63.0),
    "LONG": (80.0, 95.0),
}

# =========================================
# Tool 회전 옵션 (배치 시)
# =========================================
PLACE_ROTATE_ENABLED = True
PLACE_ROTATE_DEG = 90.0


def normalize_angle_deg(angle: float) -> float:
    """각도를 [-180, 180] 범위로 정규화"""
    a = ((angle + 180.0) % 360.0) - 180.0
    return 180.0 if a == -180.0 else a


def get_place_position(width_class: str) -> list:
    """
    물체 크기에 따른 배치 위치 반환
    
    Args:
        width_class: 'SMALL', 'MEDIUM', 'LONG', 'LARGE'
        
    Returns:
        배치 좌표 리스트 [x, y, z, rx, ry, rz]
    """
    return PLACE_POSITIONS.get(width_class, HOME_POSITION).copy()


def get_footprint(width_class: str) -> tuple:
    """분류별 바닥 면적 반환 (bw, bd)"""
    return CLASS_FOOTPRINT.get(width_class, (30.0, 30.0))
